<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="HAIP Token: Empowering AI and blockchain innovation through decentralized ecosystems." />
  <title>HAIP Token - Official Site</title>

  <!-- Fonts & libs -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    html { scroll-behavior: smooth; overflow-x: hidden; }
    body{
      font-family:'Orbitron',sans-serif; margin:0; color:#f8f8f8; overflow-x:hidden;
      background:url('images/background-cyber.jpg') no-repeat center center fixed; background-size:cover;
    }
    header{ background:rgba(31,40,51,.85); padding:20px; text-align:center; position:relative }
    header h1{ color:#66fcf1; margin:0; font-size:1.8rem }
    .logo-fixed{ position:fixed; top:25px; left:25px; height:100px; z-index:999; cursor:pointer; transition:transform .3s ease }
    .logo-fixed:hover{ transform:scale(1.1) }

    main{ padding:20px; max-width:900px; margin:auto; background:rgba(15,32,39,.8); border-radius:15px; box-shadow:0 0 30px rgba(0,255,255,.2) }
    section{ margin-bottom:20px }
    h2{ color:#45a29e; margin-bottom:10px; font-size:1.5rem }
    a{ color:#66fcf1; text-decoration:none }

    .contract{
      background:#1f2833; padding:15px 20px; border-radius:10px; word-break:break-word; font-family:monospace; font-size:.9rem;
      color:#66fcf1; text-align:center; border:1px solid #0ff0fc; box-shadow:0 0 12px rgba(0,255,252,.15); margin-bottom:10px
    }
    .btn{
      background:#66fcf1; color:#0b0c10; padding:12px 24px; border:none; border-radius:8px; font-weight:700; text-transform:uppercase;
      cursor:pointer; margin-top:10px; margin-right:10px; display:inline-block; transition:background .3s ease, transform .3s ease; position:relative; font-size:1rem; min-width:120px
    }
    .btn:hover{ background:#0ff0fc; transform:scale(1.05) }
    .btn:disabled{ background:#4a6360; cursor:not-allowed; opacity:.7 }
    .btn.loading::after{
      content:''; position:absolute; width:16px; height:16px; top:50%; right:10px; transform:translateY(-50%);
      border:2px solid #0b0c10; border-top:2px solid transparent; border-radius:50%; animation:spin 1s linear infinite
    }
    @keyframes spin{ 0%{ transform:translateY(-50%) rotate(0) } 100%{ transform:translateY(-50%) rotate(360deg) } }

    .partner-logo{ transition:transform .5s ease, filter .5s ease; filter:drop-shadow(0 0 5px rgba(102,252,241,.4)); max-width:140px }
    .partner-logo:hover{ transform:scale(1.1); filter:drop-shadow(0 0 25px #00f9ff) }
    .future-partner-logo{ height:50px; margin:10px 20px; object-fit:contain; filter:drop-shadow(0 0 5px rgba(102,252,241,.3)); transition:transform .3s ease, filter .3s ease }
    .future-partner-logo:hover{ transform:scale(1.1); filter:drop-shadow(0 0 15px #00f9ff) }
    .future-partner-logo.bybit{ height:150px } .future-partner-logo.crypto-com{ height:100px; max-width:100px } .future-partner-logo.okx{ height:100px; max-width:100px }
    .logo-section{ display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:20px; padding:20px }

    .presale-stage{ background:rgba(31,40,51,.7); border-left:4px solid #66fcf1; padding:15px; margin-bottom:10px; border-radius:8px; box-shadow:0 0 15px rgba(0,249,255,.1); animation:fadeInUp 1s ease both; transition:transform .3s ease, box-shadow .3s ease, background .3s ease; cursor:pointer }
    .presale-stage:hover{ transform:scale(1.02); box-shadow:0 0 25px rgba(0,249,255,.3); background:rgba(31,40,51,.9) }
    .presale-stage h3{ margin-top:0; color:#0ff0fc; font-size:1.2rem }
    .presale-stage p{ margin:5px 0; color:#f0f0f0; font-size:.9rem }

    .countdown{
      text-align:center; font-size:1.5rem; color:#0ff0fc; margin:20px auto; font-weight:700; text-shadow:0 0 15px #0ff0fc;
      border:2px solid #0ff0fc; border-radius:10px; padding:15px; width:fit-content; background:rgba(0,255,255,.05); animation:glowPulse 2s ease-in-out infinite
    }
    @keyframes fadeInUp{ from{ opacity:0; transform:translateY(20px) } to{ opacity:1; transform:translateY(0) } }
    @keyframes glowPulse{ 0%,100%{ box-shadow:0 0 10px #0ff0fc, 0 0 20px #0ff0fc } 50%{ box-shadow:0 0 20px #0ff0fc, 0 0 30px #0ff0fc } }

    .token-details{ display:grid; grid-template-columns:repeat(3,minmax(200px,1fr)); gap:15px; margin:10px 0 }
    .token-details div{ background:#1f2833; padding:15px; border-radius:10px; text-align:center; color:#f8f8f8; border:2px solid #1f2833; transition:border-color .3s ease, box-shadow .3s ease; display:flex; flex-direction:column; align-items:center }
    .token-details div strong{ color:#66fcf1; display:block; margin-bottom:5px }
    .token-details div:hover{ border-color:#0ff0fc; box-shadow:0 0 15px #0ff0fc, 0 0 30px rgba(0,255,252,.5) }
    canvas#tokenomicsChart{ display:block; max-width:300px; width:100%; margin:0 auto }

    .presale-status{ font-size:1rem; color:#f0f0f0; margin-bottom:8px; word-break:break-word }
    .live-status{ font-size:.95rem; color:#bfefff; opacity:.9; min-height:1.2em; margin-bottom:12px }
    .presale-limits{ font-size:1.1rem; color:#0ff0fc; text-shadow:0 0 10px #0ff0fc; margin-bottom:12px }
    .presale-input{ display:flex; flex-direction:column; gap:6px; margin-bottom:12px }
    .presale-input input{ padding:10px; border:1px solid #66fcf1; border-radius:6px; background:#1f2833; color:#f8f8f8; width:100%; max-width:320px; margin:0 auto }
    .presale-input.hidden{ display:none }
    .error-msg{ color:#ff8e8e; font-size:.9rem; text-align:center; min-height:1.2em }

    :root{ --haip-teal:#66fcf1; --haip-cyan:#0ff0fc; --haip-bg:#0b0c10; --haip-card:#1f2833 }
    .presale-v3{ display:grid; gap:14px }
    .presale-card{ background:rgba(31,40,51,.92); border:1px solid #0ff0fc22; border-radius:14px; padding:14px; box-shadow:0 6px 24px rgba(0,249,255,.15); backdrop-filter:blur(4px) }
    .presale-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap }
    .presale-title{ font-size:1.2rem; color:var(--haip-teal); margin:0 }
    .badge-stage{ font-size:.85rem; border:1px solid #0ff0fc44; color:#bff; padding:4px 10px; border-radius:999px }
    .kv{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
    .kv .box{ background:#152028; border:1px solid #0b2a31; border-radius:10px; padding:10px; text-align:center }
    .kv .box b{ display:block; color:var(--haip-teal); margin-bottom:2px }
    .progress{ height:12px; background:#132029; border:1px solid #0ff0fc33; border-radius:999px; overflow:hidden }
    .progress>i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--haip-teal),var(--haip-cyan)); box-shadow:0 0 14px #0ff0fc66 inset; transition:width .6s ease }
    .quote{ font-size:.95rem; color:#d9ffff; opacity:.9; text-align:center }

    .amount-chips{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center }
    .chip{ padding:8px 12px; border:1px solid #0ff0fc44; background:#142129; color:#eaffff; border-radius:999px; cursor:pointer; transition:transform .15s ease, border-color .2s ease }
    .chip:hover{ transform:translateY(-1px); border-color:#0ff0fc99 }
    .chip.active{ background:#122; border-color:#0ff0fc; box-shadow:0 0 10px #0ff0fc55 inset }

    .sticky-cta{ position:fixed; left:0; right:0; bottom:12px; display:none; justify-content:center; z-index:1000; padding:0 12px }
    .sticky-cta .btn{ width:100%; max-width:460px; border-radius:999px; box-shadow:0 10px 30px rgba(0,249,255,.25) }
    .toast{ position:fixed; bottom:70px; left:50%; transform:translateX(-50%) translateY(20px); opacity:0; background:#12242c; color:#eaffff; padding:10px 14px; border:1px solid #0ff0fc55; border-radius:10px; z-index:1100; transition:all .25s ease }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }

    @media(max-width:600px){
      header h1{ font-size:1.5rem } h2{ font-size:1.2rem }
      .logo-fixed{ height:80px; top:15px; left:15px }
      main{ padding:15px } .btn{ padding:10px 20px; font-size:.9rem; min-width:100px }
      .presale-stage h3{ font-size:1rem } .presale-stage p{ font-size:.8rem }
      .countdown{ font-size:1.2rem; padding:10px }
      .token-details{ grid-template-columns:1fr; gap:10px }
      .kv{ grid-template-columns:1fr }
    }
    @media(min-width:740px){
      .kv{ grid-template-columns:repeat(4,1fr) }
      .presale-title{ font-size:1.35rem }
    }
  </style>
</head>
<body>
<a href="#top"><img src="images/haip-logo-transparent.png" alt="HAIP Logo" class="logo-fixed" /></a>

<header id="top">
  <h1>Hp Artificial Intelligence Power (HAIP)</h1>
  <p>The official BEP20 token powering AI innovation on Binance Smart Chain</p>
</header>

<main>
  <section data-aos="fade-up">
    <h2>About HAIP</h2>
    <p>HAIP is a BEP-20 token on Binance Smart Chain designed to fund and integrate artificial intelligence with decentralized finance (DeFi) and Web3 ecosystems. Leveraging smart contracts, Chainlink oracles, and IPFS storage, HAIP empowers AI-driven dApps and community governance through a decentralized DAO.</p>
    <a class="btn" href="https://pancakeswap.finance/swap?outputCurrency=0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29" target="_blank">Buy on PancakeSwap</a>
    <a class="btn" href="#presale">Join Presale</a>
  </section>

  <section data-aos="fade-up">
    <h2>Token Details</h2>
    <div class="token-details">
      <div><strong>Token Name</strong> Hp Artificial Intelligence Power <img src="images/logos/hp.png" alt="HP Logo" style="display:block;max-width:80%;height:auto;margin:10px auto 0;"></div>
      <div><strong>Symbol</strong> HAIP <img src="images/haip-logo-transparent.png" alt="HAIP Logo" style="display:block;max-width:80%;height:auto;margin:10px auto 0;"></div>
      <div><strong>Decimals</strong> 18 <img src="images/haip-logo-transparent.png" alt="HAIP Logo" style="display:block;max-width:80%;height:auto;margin:10px auto 0;"></div>
      <div><strong>Total Supply</strong> 18,000,000,000 HAIP <img src="images/haip-logo-transparent.png" alt="HAIP Logo" style="display:block;max-width:80%;height:auto;margin:10px auto 0;"></div>
      <div><strong>Network</strong> Binance Smart Chain (BEP20) <img src="images/logos/bnb.png" alt="BNB Logo" style="display:block;max-width:80%;height:auto;margin:10px auto 0;"></div>
      <div>
        <strong>Contract</strong>
        <div class="contract">0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29</div>
        <button class="btn" onclick="copyContract()">Copy Contract</button>
      </div>
    </div>
  </section>

  <section data-aos="fade-up" class="tokenomics-section">
    <h2>Tokenomics</h2>
    <p><strong>Total Supply:</strong> 18,000,000,000 HAIP</p>
    <ul>
      <li><strong>Presale:</strong> 54% (9.72B HAIP, allocated across private and public stages)</li>
      <li><strong>DEX Liquidity:</strong> 27% (4.86B HAIP)</li>
      <li><strong>Development:</strong> 10% (1.8B HAIP, vested over 2 years)</li>
      <li><strong>Partners:</strong> 9% (1.62B HAIP)</li>
    </ul>
  </section>

  <div class="tokenomics-container">
    <div class="chart-legend">
      <p><span style="color:#66fcf1;">¦</span> Presale (54%)</p>
      <p><span style="color:#0ff0fc;">¦</span> DEX Liquidity (27%)</p>
      <p><span style="color:#2c3e50;">¦</span> Development (10%)</p>
      <p><span style="color:#08fdd8;">¦</span> Partners (9%)</p>
    </div>
    <canvas id="tokenomicsChart"></canvas>
  </div>

  <section data-aos="fade-up" class="roadmap-section">
    <h2>Roadmap</h2>
    <ul>
      <li><strong>Q3 2025:</strong> Initiation of private presale, token deployment, smart contract audits</li>
      <li><strong>Q4 2025:</strong> Public presale, TrustWallet integration, open-source code release on GitHub</li>
      <li><strong>Q1 2026:</strong> Community DAO setup</li>
      <li><strong>Q2 2026:</strong> AI dApp beta launch</li>
    </ul>
  </section>

  <section data-aos="fade-up">
    <h2>Presale Countdown</h2>
    <div class="countdown" id="countdown"></div>
  </section>

  <section data-aos="fade-up">
    <h2>Presale Stages</h2>

    <!-- Private Presale card (values filled) -->
    <div class="presale-stage" style="animation-delay:.2s">
      <h3>Private Presale</h3>
      <p>Allocation: <strong>2% (360,000,000 HAIP)</strong></p>
      <p>Price: <strong>0.00009 USDT</strong> per HAIP</p>
      <p>Min per user: <strong>3.24 USDT</strong> (36,000 HAIP)</p>
      <p>Max per user: <strong>90.00 USDT</strong> (1,000,000 HAIP)</p>
    </div>

    <!-- Public stages – doar informativ -->
    <div class="presale-stage" style="animation-delay:.4s">
      <h3>Public Presale - Stage 1</h3>
      <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
      <p>Price: <strong>0.0036 USDT</strong> per HAIP</p>
      <p>Min per user: <strong>9.72 USDT</strong> (2,700 HAIP)</p>
      <p>Max per user: <strong>194.4 USDT</strong> (54,000 HAIP)</p>
    </div>
    <div class="presale-stage" style="animation-delay:.6s">
      <h3>Public Presale - Stage 2</h3>
      <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
      <p>Price: <strong>0.0108 USDT</strong> per HAIP</p>
      <p>Min per user: <strong>19.44 USDT</strong> (1,800 HAIP)</p>
      <p>Max per user: <strong>388.8 USDT</strong> (36,000 HAIP)</p>
    </div>
    <div class="presale-stage" style="animation-delay:.8s">
      <h3>Public Presale - Stage 3</h3>
      <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
      <p>Price: <strong>0.0324 USDT</strong> per HAIP</p>
      <p>Min per user: <strong>29.16 USDT</strong> (900 HAIP)</p>
      <p>Max per user: <strong>874.8 USDT</strong> (27,000 HAIP)</p>
    </div>
    <div class="presale-stage" style="animation-delay:1s">
      <h3>Public Presale - Stage 4</h3>
      <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
      <p>Price: <strong>0.0972 USDT</strong> per HAIP</p>
      <p>Min per user: <strong>32.36 USDT</strong> (333 HAIP)</p>
      <p>Max per user: <strong>2,361.96 USDT</strong> (24,300 HAIP)</p>
    </div>
  </section>

  <!-- ======= PRESALE WIDGET (PRIVATE) ======= -->
  <section id="presale" class="presale-v3" data-aos="fade-up" data-aos-delay="60">
    <h2>Join Presale Now</h2>

    <!-- Stage status (always “Private”) -->
    <div class="presale-card">
      <div class="presale-head">
        <h3 class="presale-title">Private Presale</h3>
        <span class="badge-stage" id="v3StageTitle">Private</span>
      </div>

      <div class="kv" style="margin:10px 0">
        <div class="box"><b>Price</b><div id="v3StagePrice">0.00009 USDT / HAIP</div></div>
        <div class="box"><b>Your Limit (USDT)</b><div id="v3YourLimit">3.24–90.00</div></div>
        <div class="box"><b>Sold</b><div id="v3StageSold">0 / 360,000,000 HAIP</div></div>
        <div class="box"><b>Remaining</b><div id="v3StageRemaining">360,000,000 HAIP</div></div>
      </div>
      <div class="progress"><i id="v3StageProgress" style="width:0%"></i></div>
      <p class="quote" id="v3Quote">Private Presale is live. Connect your wallet to see your personalized remaining limit.</p>
    </div>

    <!-- Buy card -->
    <div class="presale-card">
      <div class="presale-status" id="presaleWalletStatus">Wallet not connected</div>
      <div class="live-status" id="gasStatus"></div>
      <div class="presale-limits" id="presaleLimits">Private Presale Limits: Min 3.24 USDT, Max 90.00 USDT · Price 0.00009 USDT/HAIP</div>

      <div class="amount-chips" id="chipsRow" style="margin:8px 0 6px">
        <button class="chip" data-min="1">Min</button>
        <button class="chip" data-usdt="25">+25</button>
        <button class="chip" data-usdt="50">+50</button>
        <button class="chip" data-usdt="75">+75</button>
        <button class="chip" data-max="1">Max</button>
      </div>

      <div class="presale-input" id="purchaseInput">
        <input type="number" id="purchaseAmount" placeholder="Amount to spend (USDT)" min="3.24" max="90" step="0.01" />
        <div id="amountError" class="error-msg"></div>
      </div>

      <div class="presale-actions" style="display:flex;justify-content:center;gap:10px;flex-wrap:wrap">
        <button class="btn" id="presaleConnectWalletBtn">Connect Wallet</button>
        <button class="btn hidden" id="presaleDisconnectWalletBtn">Disconnect Wallet</button>
        <button class="btn" id="purchaseBtn" disabled>Purchase</button>
      </div>
    </div>

    <div class="sticky-cta" id="stickyCta">
      <button class="btn" id="stickyBuyBtn">Buy HAIP</button>
    </div>
    <div class="toast" id="toast">Copied!</div>
  </section>

  <section data-aos="fade-up">
    <h2>Contact Us</h2>
    <ul>
      <li>Email: <a href="mailto:contact@haip-token.org">contact@haip-token.org</a></li>
      <li>Telegram: <a href="https://t.me/haipcommunity" target="_blank">@haipcommunity</a></li>
      <li>Twitter: <a href="https://twitter.com/haiptoken" target="_blank">@haiptoken</a></li>
      <li>Discord: <a href="https://discord.gg/haip" target="_blank">HAIP Community</a></li>
    </ul>
  </section>

  <section data-aos="fade-up">
    <h2>Resources</h2>
    <ul>
      <li><a href="https://bscscan.com/token/0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29" target="_blank">View on BscScan</a></li>
      <li><a href="https://github.com/Darck120579/assets" target="_blank">GitHub Repository (Coming Q4 2025)</a></li>
    </ul>
  </section>

  <section data-aos="fade-up">
    <h2>Legal Disclaimer</h2>
    <p>HAIP Token is a utility token, not a security or equity in any entity. Participants must comply with local regulations before acquiring or transacting with HAIP. All smart contracts undergo independent public audits prior to deployment (Q3 2025). KYC and AML procedures are enforced for presale participants and regulated partner platforms.</p>
  </section>
</main>

<!-- Libs -->
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

<script>
/* ================== VISUALS ================== */
AOS.init({ duration: 1000 });

// Countdown
const countdown = document.getElementById('countdown');
const launchDate = new Date('2025-08-01T00:00:00Z').getTime();
const updateCountdown = () => {
  const now = new Date().getTime();
  const d = launchDate - now;
  if (d <= 0) { countdown.innerHTML = "Private Presale is Live!"; countdown.style.animation='none'; countdown.style.border='2px solid #66fcf1'; return; }
  const days = Math.floor(d / (1000*60*60*24));
  const hours = Math.floor((d % (1000*60*60*24)) / (1000*60*60));
  const minutes = Math.floor((d % (1000*60*60)) / (1000*60));
  const seconds = Math.floor((d % (1000*60)) / 1000);
  countdown.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
};
setInterval(updateCountdown, 1000); updateCountdown();

// Tokenomics chart (simple)
const ctx = document.getElementById('tokenomicsChart').getContext('2d');
new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['Presale (54%)', 'DEX Liquidity (27%)', 'Development (10%)', 'Partners (9%)'],
    datasets: [{ data: [54, 27, 10, 9], backgroundColor: ['#66fcf1', '#0ff0fc', '#2c3e50', '#08fdd8'], borderColor: '#0b0c10', borderWidth: 2, hoverOffset: 20 }]
  },
  options: { responsive:true, maintainAspectRatio:true, plugins:{ legend:{display:false} } }
});
</script>

<script>
/* ================== PRIVATE PRESALE – WEB3 LOGIC ================== */
const presaleWalletStatus = document.getElementById('presaleWalletStatus');
const presaleConnectWalletBtn = document.getElementById('presaleConnectWalletBtn');
const presaleDisconnectWalletBtn = document.getElementById('presaleDisconnectWalletBtn');
const purchaseBtn = document.getElementById('purchaseBtn');
const purchaseInput = document.getElementById('purchaseInput');
const purchaseAmountInput = document.getElementById('purchaseAmount');
const amountError = document.getElementById('amountError');
const presaleLimits = document.getElementById('presaleLimits');
const gasStatus = document.getElementById('gasStatus');

// Stage small UI (kept here for live refresh)
const v3Title = document.getElementById('v3StageTitle');
const v3Price = document.getElementById('v3StagePrice');
const v3Sold = document.getElementById('v3StageSold');
const v3Rem = document.getElementById('v3StageRemaining');
const v3Prog = document.getElementById('v3StageProgress');
const v3Quote = document.getElementById('v3Quote');

// Addrs (BSC mainnet)
const HAIP_ADDRESS   = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
const USDT_ADDRESS   = '0x55d398326f99059fF775485246999027B3197955';
const PRESALE_ADDRESS= '0x07e11a90bFea0f38D203f25C26c21de1cD78bFf7';

// ABIs
const HAIP_ABI = [
  {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}
];
const USDT_ABI = [
  {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}
];
const PRESALE_ABI = [
  {"inputs":[{"internalType":"uint256","name":"usdtAmount","type":"uint256"}],"name":"buy","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"currentStage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"}],"name":"getStage","outputs":[
    {"internalType":"uint256","name":"priceNum","type":"uint256"},
    {"internalType":"uint256","name":"minUsdt","type":"uint256"},
    {"internalType":"uint256","name":"maxUsdt","type":"uint256"},
    {"internalType":"uint256","name":"capTokens","type":"uint256"},
    {"internalType":"uint256","name":"soldTokens","type":"uint256"}
  ],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"},{"internalType":"address","name":"user","type":"address"}],"name":"maxUsdtUserCanBuy","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"},{"internalType":"uint256","name":"usdtAmount","type":"uint256"}],"name":"quoteTokens","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
];

let web3, haipContract, usdtContract, presaleContract;
let connectedAddress = null, haipDec = 18, usdtDec = 18;

// ---- PRIVATE CONSTANTS (UI & guardrails) ----
const PRIVATE_PRICE = 0.00009;
const PRIVATE_MIN   = 3.24;
const PRIVATE_MAX   = 90.00;
const PRIVATE_CAP   = 360000000; // 2% din 18B

// Helpers
const fmt = (n,d=2)=>Number(n).toLocaleString(undefined,{maximumFractionDigits:d});
const toUnits = (web3, val, dec) => { // fixed 6-dec prec. to avoid FP drift
  const bn = web3.utils.toBN(Math.floor((+val) * 1e6));
  const scale = web3.utils.toBN(10).pow(web3.utils.toBN(dec - 6));
  return bn.mul(scale);
};
const fromUnits = (web3, bn, dec) => {
  const s = bn.toString();
  const pad = s.padStart(dec+1, '0');
  const intPart = pad.slice(0, -dec);
  const fracPart = pad.slice(-dec, -dec+6);
  return Number(`${intPart}.${fracPart}`);
};

const GOOD_BSC_RPCS = [
  'https://bsc-dataseed.binance.org',
  'https://bsc-dataseed1.ninicoin.io',
  'https://bsc.rpc.blxrbdn.com',
  'https://rpc.ankr.com/bsc'
];

async function initWeb3(){
  if (window.ethereum) {
    web3 = new Web3(window.ethereum);
  } else if (window.web3) {
    web3 = new Web3(window.web3.currentProvider);
  } else {
    presaleWalletStatus.innerHTML = 'No wallet provider detected. Please install <a href="https://metamask.io/download" target="_blank">MetaMask</a> or <a href="https://trustwallet.com/download" target="_blank">Trust Wallet</a>.';
    return false;
  }
  haipContract = new web3.eth.Contract(HAIP_ABI, HAIP_ADDRESS);
  usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
  presaleContract = new web3.eth.Contract(PRESALE_ABI, PRESALE_ADDRESS);
  try { haipDec = await haipContract.methods.decimals().call(); } catch {}
  try { usdtDec = await usdtContract.methods.decimals().call(); } catch {}
  return true;
}
async function checkNetwork(){
  try{
    const chainId = await web3.eth.getChainId();
    if (chainId !== 56) {
      await window.ethereum.request({ method:'wallet_switchEthereumChain', params:[{ chainId:'0x38' }] });
    }
    return true;
  }catch(e){
    if (e.code === 4902 || String(e.message||'').toLowerCase().includes('missing trie node')) {
      await window.ethereum.request({
        method:'wallet_addEthereumChain',
        params:[{ chainId:'0x38', chainName:'Binance Smart Chain', nativeCurrency:{name:'BNB',symbol:'BNB',decimals:18}, rpcUrls:GOOD_BSC_RPCS, blockExplorerUrls:['https://bscscan.com'] }]
      });
      return true;
    }
    presaleWalletStatus.textContent = 'Failed to switch to Binance Smart Chain.'; return false;
  }
}
const GAS_CONF = { minGwei:2.5, startGwei:3.0, maxGwei:6.0, safety:1.2, capApprove:220000, capBuy:350000 };
const g = (n)=>web3.utils.toWei(String(n), 'gwei');
const setGasStatus = (msg)=>{ if(gasStatus) gasStatus.textContent = msg || ''; };

async function pickGasPriceGwei(){
  try{
    const netWei = await web3.eth.getGasPrice();
    const netGwei = Number(web3.utils.fromWei(netWei,'gwei'));
    return Math.max(GAS_CONF.minGwei, Math.min(netGwei, GAS_CONF.maxGwei));
  }catch{ return GAS_CONF.startGwei; }
}
async function estimateGasCapped(call, from, valueWei, cap){
  try{
    const est = await call.estimateGas({from, value: valueWei || '0x0'});
    return Math.min(Math.ceil(est * GAS_CONF.safety), cap);
  }catch{ return cap; }
}
function isTrieError(err){
  const m = String(err?.message || '').toLowerCase();
  return m.includes('missing trie node') || m.includes('state node') || err?.code === -32000;
}
async function sendWithLowFee(call, { from, valueWei='0x0', cap, label }){
  let gasPriceGwei = await pickGasPriceGwei();
  try{
    const gasLimit = await estimateGasCapped(call, from, valueWei, cap);
    setGasStatus(`${label}… ${gasPriceGwei.toFixed(2)} gwei · gas ? ${gasLimit}`);
    return await call.send({ from, gas: gasLimit, gasPrice: g(gasPriceGwei), value: valueWei });
  }catch(e1){
    if (isTrieError(e1)) {
      setGasStatus('RPC node error. Switching to a healthy BSC RPC…');
      try{ await checkNetwork(); }catch{}
    }
    try{
      setGasStatus(`${label} retry via wallet estimator…`);
      return await call.send({ from, value: valueWei });
    }catch(e2){
      const msg = String(e2?.message||'').toLowerCase();
      if ((msg.includes('underpriced') || msg.includes('replacement') || msg.includes('price too low'))) {
        gasPriceGwei = Math.min(gasPriceGwei + 1.0, GAS_CONF.maxGwei);
        const gasLimit = await estimateGasCapped(call, from, valueWei, cap);
        return await call.send({ from, gas: gasLimit, gasPrice: g(gasPriceGwei), value: valueWei });
      }
      throw e2;
    }
  }
}

// Validation helpers (avoid “Below stage minimum”)
function setError(msg){
  amountError.textContent = msg || '';
  if (msg) purchaseAmountInput.classList.add('input-error');
  else purchaseAmountInput.classList.remove('input-error');
}
function isValidAmount(val){
  if (val === '' || isNaN(val)) return false;
  const n = parseFloat(val);
  if (n < PRIVATE_MIN) { setError(`Minimum is ${PRIVATE_MIN.toFixed(2)} USDT`); return false; }
  if (n > PRIVATE_MAX) { setError(`Maximum is ${PRIVATE_MAX.toFixed(2)} USDT`); return false; }
  setError(''); return true;
}
function refreshPurchaseButtonState(){
  const ok = isValidAmount(purchaseAmountInput.value);
  purchaseBtn.disabled = !ok || !connectedAddress;
}
purchaseAmountInput?.addEventListener('input', refreshPurchaseButtonState);

// Connect / Disconnect
async function connectWallet(){
  presaleConnectWalletBtn.classList.add('loading'); presaleConnectWalletBtn.disabled = true;
  try{
    if (!await initWeb3()) throw new Error('No wallet provider detected.');
    if (!await checkNetwork()) throw new Error('Wrong network');
    const accounts = await window.ethereum.request({ method:'eth_requestAccounts' });
    if (accounts.length === 0) throw new Error('No accounts authorized.');
    connectedAddress = accounts[0];

    const balance = await haipContract.methods.balanceOf(connectedAddress).call().catch(()=>0);
    presaleWalletStatus.textContent = `Connected: ${connectedAddress.slice(0,6)}...${connectedAddress.slice(-4)} · Balance ${fromUnits(web3, web3.utils.toBN(balance), haipDec).toFixed(6)} HAIP`;
    presaleConnectWalletBtn.classList.add('hidden');
    presaleDisconnectWalletBtn.classList.remove('hidden');
    purchaseInput.classList.remove('hidden');
    refreshPurchaseButtonState();
    await refreshStageUI(); // fills YourLimit if contract supports it

    window.ethereum.on('accountsChanged', ()=>location.reload());
    window.ethereum.on('chainChanged', ()=>location.reload());
  }catch(error){
    presaleWalletStatus.textContent = `Error: ${error.message || 'Failed to connect wallet'}`;
  }finally{
    presaleConnectWalletBtn.classList.remove('loading'); presaleConnectWalletBtn.disabled = false;
  }
}
function disconnectWallet(){
  connectedAddress = null;
  presaleWalletStatus.textContent = 'Wallet not connected';
  gasStatus.textContent = '';
  presaleConnectWalletBtn.classList.remove('hidden');
  presaleDisconnectWalletBtn.classList.add('hidden');
  purchaseBtn.disabled = true; purchaseInput.classList.add('hidden');
  purchaseAmountInput.value = '';
  setError('');
  refreshStageUI();
}
presaleConnectWalletBtn.addEventListener('click', connectWallet);
presaleDisconnectWalletBtn.addEventListener('click', disconnectWallet);

// Private UI refresh (reads contract if possible; clamps to Private caps)
async function refreshStageUI(){
  try{
    // default Private
    v3Title.textContent = 'Private';
    v3Price.textContent = `${PRIVATE_PRICE.toFixed(5)} USDT / HAIP`;

    let sold = 0, cap = PRIVATE_CAP;

    if (presaleContract && web3) {
      try{
        const idx = await presaleContract.methods.currentStage().call();
        const st  = await presaleContract.methods.getStage(idx).call();
        const soldOnChain = fromUnits(web3, web3.utils.toBN(st.soldTokens || st[4]), haipDec);
        const capOnChain  = fromUnits(web3, web3.utils.toBN(st.capTokens  || st[3]), haipDec);
        // folosim on-chain doar dacă nu sare de cap-ul Privat (evităm valorile publice)
        if (capOnChain > 0 && capOnChain <= PRIVATE_CAP * 1.01) {
          sold = Math.max(0, Math.min(soldOnChain, capOnChain));
          cap  = capOnChain;
        }
      }catch{}
    }

    const remaining = Math.max(cap - sold, 0);
    const pct = cap > 0 ? Math.min((sold / cap) * 100, 100) : 0;

    v3Sold.textContent = `${fmt(sold,2)} / ${fmt(cap,0)} HAIP`;
    v3Rem.textContent  = `${fmt(remaining,0)} HAIP`;
    v3Prog.style.width = `${pct.toFixed(2)}%`;

    // limits line + input attrs
    presaleLimits.textContent =
      `Private Presale Limits: Min ${PRIVATE_MIN.toFixed(2)} USDT, Max ${PRIVATE_MAX.toFixed(2)} USDT · Price ${PRIVATE_PRICE.toFixed(5)} USDT/HAIP`;
    purchaseAmountInput.min = PRIVATE_MIN;
    purchaseAmountInput.max = PRIVATE_MAX;

    // personalized limit (if contract supports per-user tracking)
    if (connectedAddress && presaleContract && web3) {
      try {
        const idx = await presaleContract.methods.currentStage().call();
        const maxUser = await presaleContract.methods.maxUsdtUserCanBuy(idx, connectedAddress).call();
        const maxUserFloat = fromUnits(web3, web3.utils.toBN(maxUser), usdtDec);
        const allowed = Math.max(0, Math.min(maxUserFloat, PRIVATE_MAX));
        document.getElementById('v3YourLimit').textContent = `${allowed.toFixed(2)}`;
        v3Quote.textContent = `You can still buy up to ${allowed.toFixed(2)} USDT in this stage.`;
      } catch {
        document.getElementById('v3YourLimit').textContent = `3.24–90.00`;
        v3Quote.textContent = `Private Presale is live. Connect your wallet to see your personalized remaining limit.`;
      }
    } else {
      document.getElementById('v3YourLimit').textContent = `3.24–90.00`;
      v3Quote.textContent = `Private Presale is live. Connect your wallet to see your personalized remaining limit.`;
    }
  }catch(e){}
}
setInterval(refreshStageUI, 20000);

// Purchase
async function purchaseTokens(){
  if (purchaseInput.classList.contains('hidden')) { purchaseInput.classList.remove('hidden'); return; }
  if (!isValidAmount(purchaseAmountInput.value)) { refreshPurchaseButtonState(); return; }

  purchaseBtn.classList.add('loading'); purchaseBtn.disabled = true;
  try{
    if (!web3 || !usdtContract || !presaleContract || !connectedAddress) throw new Error('Wallet not connected');
    let usdtAmount = parseFloat(purchaseAmountInput.value);

    // enforce private min/max on frontend to avoid revert
    if (usdtAmount < PRIVATE_MIN) usdtAmount = PRIVATE_MIN;
    if (usdtAmount > PRIVATE_MAX) usdtAmount = PRIVATE_MAX;
    purchaseAmountInput.value = usdtAmount.toFixed(2);

    // if contract has per-user cap, clamp further
    try{
      const idx = await presaleContract.methods.currentStage().call();
      const maxUser = await presaleContract.methods.maxUsdtUserCanBuy(idx, connectedAddress).call();
      const maxUserFloat = fromUnits(web3, web3.utils.toBN(maxUser), usdtDec);
      if (maxUserFloat <= 0) throw new Error('Your current limit is 0 USDT for this stage.');
      if (usdtAmount > maxUserFloat) {
        usdtAmount = Math.floor(maxUserFloat * 100) / 100;
        purchaseAmountInput.value = usdtAmount.toFixed(2);
        presaleWalletStatus.textContent = `Amount reduced to your current limit: ${usdtAmount.toFixed(2)} USDT.`;
      }
    }catch{}

    const usdtUnits = toUnits(web3, usdtAmount, usdtDec);

    // Approve USDT if needed
    const allowance = await usdtContract.methods.allowance(connectedAddress, PRESALE_ADDRESS).call();
    if (web3.utils.toBN(allowance).lt(usdtUnits)) {
      setGasStatus('Approving USDT…');
      await sendWithLowFee(
        usdtContract.methods.approve(PRESALE_ADDRESS, usdtUnits.toString()),
        { from: connectedAddress, cap: GAS_CONF.capApprove, label: 'Approve' }
      );
    }

    // Optional quote for UI
    let haipAmountStr = '';
    try {
      const idx = await presaleContract.methods.currentStage().call();
      const tokens = await presaleContract.methods.quoteTokens(idx, usdtUnits.toString()).call();
      const haipFloat = fromUnits(web3, web3.utils.toBN(tokens), haipDec);
      haipAmountStr = ` (~${haipFloat.toFixed(6)} HAIP)`;
    } catch {}

    setGasStatus('Submitting purchase…');
    const tx = await sendWithLowFee(
      presaleContract.methods.buy(usdtUnits.toString()),
      { from: connectedAddress, cap: GAS_CONF.capBuy, label: 'Buy' }
    );

    presaleWalletStatus.innerHTML = `Success${haipAmountStr}! <a target="_blank" href="https://bscscan.com/tx/${tx.transactionHash}">View on BscScan</a>`;
    setGasStatus('Done.');
    purchaseInput.classList.add('hidden'); purchaseAmountInput.value = '';
    setError('');
    await refreshStageUI();
  }catch(error){
    presaleWalletStatus.textContent = `Error: ${error.message || 'Purchase failed'}`;
    if (isTrieError?.(error)) gasStatus.textContent = 'Your RPC may be pruned/unstable. Switch RPC in MetaMask to: bsc-dataseed.binance.org / ankr / ninicoin.';
  }finally{
    purchaseBtn.classList.remove('loading');
    refreshPurchaseButtonState();
  }
}
purchaseBtn.addEventListener('click', purchaseTokens);

// Copy contract address helper
function copyContract(){
  const contractAddress = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
  navigator.clipboard.writeText(contractAddress).then(() => alert('Contract address copied to clipboard!'));
}

// Init
(async () => {
  try {
    if (window.ethereum || window.web3) await initWeb3();
    await refreshStageUI();
    refreshPurchaseButtonState();
  } catch {}
})();
</script>

<script>
/* ================== PRIVATE PRESALE – UX ENHANCEMENTS ================== */
(function(){
  const chips = Array.from(document.querySelectorAll('.chip'));
  const amountInput = document.getElementById('purchaseAmount');
  const purchaseBtn = document.getElementById('purchaseBtn');
  const yourLimitEl = document.getElementById('v3YourLimit');
  const sticky = document.getElementById('stickyCta');
  const stickyBtn = document.getElementById('stickyBuyBtn');
  const toast = document.getElementById('toast');

  const showToast = (msg)=>{
    if(!toast) return; toast.textContent = msg || 'Done';
    toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1500);
  };
  const num = (v,def=0)=>{ const n = parseFloat(String(v).replace(',', '.')); return isFinite(n) ? n : def; };

  function currentMin(){
    const a = num(amountInput?.min, NaN);
    if (isFinite(a)) return a;
    return typeof PRIVATE_MIN !== 'undefined' ? PRIVATE_MIN : 0;
  }
  function currentMax(){
    const ui = yourLimitEl ? num((yourLimitEl.textContent||'').replace(/[^0-9.]/g,''), NaN) : NaN;
    if (isFinite(ui) && ui > 0) return ui;
    const a = num(amountInput?.max, NaN);
    if (isFinite(a)) return a;
    return typeof PRIVATE_MAX !== 'undefined' ? PRIVATE_MAX : Infinity;
  }
  function clampToStage(v){
    const mn = currentMin(), mx = currentMax();
    if (!isFinite(v)) v = mn;
    if (v < mn) v = mn;
    if (v > mx) v = mx;
    return Number(v.toFixed(2));
  }

  // Min / +25 / +50 / +75 / Max
  chips.forEach(ch=>{
    ch.addEventListener('click', ()=>{
      chips.forEach(c=>c.classList.remove('active'));
      ch.classList.add('active');

      const isMax = ch.dataset.max === '1';
      const isMin = ch.dataset.min === '1';
      if (isMin) {
        amountInput.value = clampToStage(currentMin()).toFixed(2);
      } else if (isMax) {
        amountInput.value = clampToStage(currentMax()).toFixed(2);
      } else {
        const inc = num(ch.dataset.usdt, 0);
        const cur = num(amountInput.value, 0);
        amountInput.value = clampToStage(cur + inc).toFixed(2);
      }
      amountInput.dispatchEvent(new Event('input'));
    });
  });

  function refreshPurchaseState(){
    const v = num(amountInput.value, NaN);
    const okNum = isFinite(v) && v >= currentMin() && v <= currentMax();
    purchaseBtn.disabled = !(okNum && !!(window.connectedAddress));
  }
  amountInput?.addEventListener('input', refreshPurchaseState);

  function updateSticky(){
    const mq = window.matchMedia('(max-width: 740px)');
    sticky.style.display = mq.matches ? 'flex' : 'none';
  }
  updateSticky(); window.addEventListener('resize', updateSticky);

  stickyBtn?.addEventListener('click', ()=>{
    document.getElementById('purchaseBtn')?.click();
  });

  window.copyContract = function(){
    const addr = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
    navigator.clipboard.writeText(addr).then(()=>showToast('Contract copied'));
  };

  setTimeout(refreshPurchaseState, 400);
  const iv = setInterval(refreshPurchaseState, 1500);
  window.addEventListener('beforeunload', ()=>clearInterval(iv));
})();
</script>

</body>
</html>
