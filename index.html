<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="HAIP Token: Empowering AI and blockchain innovation through decentralized ecosystems." />
  <title>HAIP Token - Official Site</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
  <style>
    html { scroll-behavior: smooth; overflow-x: hidden; }
    body {
      font-family: 'Orbitron', sans-serif;
      background: url('images/background-cyber.jpg') no-repeat center center fixed;
      background-size: cover; color: #f8f8f8; margin: 0; padding: 0;
    }
    header { background: rgba(31, 40, 51, 0.85); padding: 20px; text-align: center; position: relative; }
    header h1 { color: #66fcf1; margin: 0; font-size: 1.8rem; }
    .logo-fixed { position: fixed; top: 25px; left: 25px; height: 100px; z-index: 999; cursor: pointer; transition: transform 0.3s ease; }
    .logo-fixed:hover { transform: scale(1.1); }
    main {
      padding: 20px; max-width: 900px; margin: auto;
      background-color: rgba(15, 32, 39, 0.8);
      border-radius: 15px; box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
    }
    section { margin-bottom: 20px; }
    h2 { color: #45a29e; margin-bottom: 10px; font-size: 1.5rem; }
    a { color: #66fcf1; text-decoration: none; }
    .contract {
      background: #1f2833; padding: 15px 20px; border-radius: 10px;
      font-family: monospace; color: #66fcf1; text-align: center;
      border: 1px solid #0ff0fc; box-shadow: 0 0 12px rgba(0, 255, 252, 0.15);
    }
    .btn {
      background: #66fcf1; color: #0b0c10; padding: 12px 24px; border: none;
      border-radius: 5px; font-weight: bold; text-transform: uppercase;
      cursor: pointer; margin-top: 10px; margin-right: 10px;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .btn:hover { background: #0ff0fc; transform: scale(1.05); }
    .btn:disabled { background: #4a6360; cursor: not-allowed; opacity: 0.7; }
    .partner-logo { transition: transform 0.5s ease; filter: drop-shadow(0 0 5px rgba(102,252,241,0.4)); max-width: 140px; }
    .partner-logo:hover { transform: scale(1.1); filter: drop-shadow(0 0 25px #00f9ff); }
    .presale-stage {
      background: rgba(31, 40, 51, 0.7); border-left: 4px solid #66fcf1;
      padding: 15px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,249,255,0.1);
      transition: transform 0.3s ease; cursor: pointer;
    }
    .presale-stage:hover { transform: scale(1.02); background: rgba(31,40,51,0.9); }
    .presale-v3 { display: grid; gap: 14px; }
    .presale-card {
      background: rgba(31,40,51,.92); border: 1px solid #0ff0fc22;
      border-radius: 14px; padding: 14px; box-shadow: 0 6px 24px rgba(0,249,255,.15);
    }
    .presale-actions .btn { min-width: 140px; }
    .sticky-cta { position: fixed; left: 0; right: 0; bottom: 12px; display: none; justify-content: center; z-index: 1000; }
    .sticky-cta .btn { width: 100%; max-width: 460px; border-radius: 999px; }
    .toast { position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); opacity: 0;
      background: #12242c; color: #eaffff; padding: 10px 14px;
      border: 1px solid #0ff0fc55; border-radius: 10px; transition: all .25s ease;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
  </style>
</head>

<body>
<a href="#top"><img src="images/haip-logo-transparent.png" alt="HAIP Logo" class="logo-fixed" /></a>
<header id="top">
  <h1>Hp Artificial Intelligence Power (HAIP)</h1>
  <p>The official BEP20 token powering AI innovation on Binance Smart Chain</p>
</header>

<main>
  <section>
    <h2>About HAIP</h2>
    <p>HAIP Token is a BEP-20 token on Binance Smart Chain designed to integrate AI and DeFi through community-driven innovation.</p>
    <a class="btn" href="#presale">Join Presale</a>
  </section>

  <section>
    <h2>Token Details</h2>
    <div class="token-details">
      <div><strong>Token:</strong> HAIP</div>
      <div><strong>Network:</strong> Binance Smart Chain</div>
      <div><strong>Contract:</strong>
        <div class="contract">0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29</div>
        <button class="btn" onclick="copyContract()">Copy Contract</button>
      </div>
    </div>
  </section>

  <section>
    <h2>Presale Stages</h2>
    <div class="presale-stage">
      <h3>Private Presale</h3>
      <p>Allocation: 2% (360M HAIP)</p>
      <p>Price: <strong>0.00009 USDT</strong></p>
      <p>Min: <strong>3.24</strong> — Max: <strong>90 USDT</strong></p>
    </div>
    <div class="presale-stage">
      <h3>Public Presale - Stage 1</h3>
      <p>Price: 0.0036 USDT</p>
      <p>Allocation: 2.34B HAIP</p>
    </div>
  </section>

  <section id="presale" class="presale-v3">
    <h2>Join Presale Now</h2>
    <div class="presale-card">
      <div class="presale-head">
        <h3 class="presale-title">Private Presale</h3>
        <span class="badge-stage" id="v3StageTitle">Private</span>
      </div>
      <div class="kv">
        <div><b>Price</b><div id="v3StagePrice">0.00009 USDT / HAIP</div></div>
        <div><b>Your Limit</b><div id="v3YourLimit">3.24–90.00</div></div>
        <div><b>Sold</b><div id="v3StageSold">0 / 360,000,000 HAIP</div></div>
        <div><b>Remaining</b><div id="v3StageRemaining">360,000,000 HAIP</div></div>
      </div>
      <div class="progress"><i id="v3StageProgress" style="width:0%"></i></div>
      <p class="quote" id="v3Quote">Private Presale is live. Connect wallet.</p>
    </div>

    <div class="presale-card">
      <div id="presaleWalletStatus">Wallet not connected</div>
      <div id="gasStatus"></div>
      <div id="presaleLimits">Min 3.24 · Max 90.00 · Price 0.00009 USDT/HAIP</div>
      <div class="amount-chips">
        <button class="chip" data-min="1">Min</button>
        <button class="chip" data-usdt="25">+25</button>
        <button class="chip" data-usdt="50">+50</button>
        <button class="chip" data-usdt="75">+75</button>
        <button class="chip" data-max="1">Max</button>
      </div>
      <input type="number" id="purchaseAmount" placeholder="Amount to spend (USDT)" min="3.24" max="90" step="0.01" />
      <div id="amountError" class="error-msg"></div>
      <button class="btn" id="presaleConnectWalletBtn">Connect Wallet</button>
      <button class="btn hidden" id="presaleDisconnectWalletBtn">Disconnect Wallet</button>
      <button class="btn" id="purchaseBtn" disabled>Purchase</button>
    </div>

    <div class="sticky-cta" id="stickyCta">
      <button class="btn" id="stickyBuyBtn">Buy HAIP</button>
    </div>
    <div class="toast" id="toast">Copied!</div>
  </section>

  <section>
    <h2>Contact</h2>
    <ul>
      <li>Email: contact@haip-token.org</li>
      <li>Telegram: @haipcommunity</li>
    </ul>
  </section>
</main>
<script>
/* ================== PRIVATE PRESALE WEB3 LOGIC ================== */

// -------- CONFIG PRIVATE PRESALE --------
const EXPECT_STAGE_IDX = 0;
const PRIVATE_MIN = 3.24;
const PRIVATE_MAX = 90.00;
const PRIVATE_PRICE = 0.00009;
const PRIVATE_CAP = 360000000;

const HAIP_ADDRESS = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
const USDT_ADDRESS = '0x55d398326f99059fF775485246999027B3197955';
const PRESALE_ADDRESS = '0x07e11a90bFea0f38D203f25C26c21de1cD78bFf7';

// -------- ABI --------
const HAIP_ABI = [
  {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}
];
const USDT_ABI = [
  {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}
];
const PRESALE_ABI = [
  {"inputs":[{"internalType":"uint256","name":"usdtAmount","type":"uint256"}],"name":"buy","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"currentStage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"}],"name":"getStage","outputs":[
    {"internalType":"uint256","name":"priceNum","type":"uint256"},
    {"internalType":"uint256","name":"minUsdt","type":"uint256"},
    {"internalType":"uint256","name":"maxUsdt","type":"uint256"},
    {"internalType":"uint256","name":"capTokens","type":"uint256"},
    {"internalType":"uint256","name":"soldTokens","type":"uint256"}
  ],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"},{"internalType":"address","name":"user","type":"address"}],"name":"maxUsdtUserCanBuy","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"},{"internalType":"uint256","name":"usdtAmount","type":"uint256"}],"name":"quoteTokens","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
];

// -------- GLOBAL VARS --------
let web3, haipContract, usdtContract, presaleContract;
let connectedAddress = null, haipDec = 18, usdtDec = 18;

// -------- UTILITARE --------
const fmt = (n,d=2)=>Number(n).toLocaleString(undefined,{maximumFractionDigits:d});
const toUnits = (web3,val,dec)=>{
  const bn = web3.utils.toBN(Math.floor((+val)*1e6));
  const scale = web3.utils.toBN(10).pow(web3.utils.toBN(dec-6));
  return bn.mul(scale);
};
const fromUnits = (web3,bn,dec)=>{
  const s = bn.toString();
  const pad = s.padStart(dec+1,'0');
  const intPart = pad.slice(0,-dec);
  const fracPart = pad.slice(-dec,-dec+6);
  return Number(`${intPart}.${fracPart}`);
};

// -------- GAS CONFIG --------
const GAS_CONF = { minGwei:2.5, startGwei:3.0, maxGwei:6.0, safety:1.2, capApprove:220000, capBuy:350000 };
const g = (n)=>web3.utils.toWei(String(n),'gwei');
const gasStatus = document.getElementById('gasStatus');
function setGasStatus(msg){ gasStatus.textContent = msg || ''; }

async function pickGasPriceGwei(){
  try{
    const netWei = await web3.eth.getGasPrice();
    const netGwei = Number(web3.utils.fromWei(netWei,'gwei'));
    return Math.max(GAS_CONF.minGwei, Math.min(netGwei, GAS_CONF.maxGwei));
  }catch{ return GAS_CONF.startGwei; }
}
async function estimateGasCapped(call, from, valueWei, cap){
  try{ const est = await call.estimateGas({from, value:valueWei||'0x0'});
       return Math.min(Math.ceil(est*GAS_CONF.safety), cap);
  }catch{ return cap; }
}
function isTrieError(err){
  const m = String(err?.message||'').toLowerCase();
  return m.includes('missing trie node') || m.includes('state node') || err?.code===-32000;
}
async function sendWithLowFee(call, {from, valueWei='0x0', cap, label}){
  let gasPriceGwei = await pickGasPriceGwei();
  try{
    const gasLimit = await estimateGasCapped(call, from, valueWei, cap);
    setGasStatus(`${label}… ${gasPriceGwei.toFixed(2)} gwei`);
    return await call.send({from, gas:gasLimit, gasPrice:g(gasPriceGwei), value:valueWei});
  }catch(e1){
    if(isTrieError(e1)) setGasStatus('RPC unstable, retrying...');
    try{ return await call.send({from,value:valueWei}); }
    catch(e2){
      const msg = String(e2?.message||'').toLowerCase();
      if(msg.includes('underpriced')||msg.includes('replacement')){
        gasPriceGwei = Math.min(gasPriceGwei+1,GAS_CONF.maxGwei);
        const gasLimit = await estimateGasCapped(call, from, valueWei, cap);
        return await call.send({from,gas:gasLimit,gasPrice:g(gasPriceGwei),value:valueWei});
      }
      throw e2;
    }
  }
}

// -------- INIT WEB3 --------
async function initWeb3(){
  if(window.ethereum){ web3 = new Web3(window.ethereum); }
  else if(window.web3){ web3 = new Web3(window.web3.currentProvider); }
  else{
    document.getElementById('presaleWalletStatus').textContent='No wallet detected. Install MetaMask.';
    return false;
  }
  haipContract = new web3.eth.Contract(HAIP_ABI, HAIP_ADDRESS);
  usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
  presaleContract = new web3.eth.Contract(PRESALE_ABI, PRESALE_ADDRESS);
  try{ haipDec = await haipContract.methods.decimals().call(); }catch{}
  try{ usdtDec = await usdtContract.methods.decimals().call(); }catch{}
  return true;
}

// -------- CONECTARE WALLET --------
async function connectWallet(){
  const btn = document.getElementById('presaleConnectWalletBtn');
  btn.classList.add('loading'); btn.disabled = true;
  try{
    if(!await initWeb3()) throw new Error('Init failed');
    const accounts = await window.ethereum.request({method:'eth_requestAccounts'});
    if(!accounts.length) throw new Error('No account');
    connectedAddress = accounts[0];
    const bal = await haipContract.methods.balanceOf(connectedAddress).call().catch(()=>0);
    const balF = fromUnits(web3, web3.utils.toBN(bal), haipDec).toFixed(3);
    document.getElementById('presaleWalletStatus').textContent =
      `Connected: ${connectedAddress.slice(0,6)}...${connectedAddress.slice(-4)} · ${balF} HAIP`;
    btn.classList.add('hidden');
    document.getElementById('presaleDisconnectWalletBtn').classList.remove('hidden');
    document.getElementById('purchaseBtn').disabled = false;
    await refreshStageUI();
  }catch(e){
    document.getElementById('presaleWalletStatus').textContent = 'Error: '+(e.message||'Connect failed');
  }finally{ btn.classList.remove('loading'); btn.disabled=false; }
}

// -------- REFRESH PRIVATE STAGE --------
async function refreshStageUI(){
  const stageEl = document.getElementById('v3StageTitle');
  const priceEl = document.getElementById('v3StagePrice');
  const soldEl = document.getElementById('v3StageSold');
  const remEl = document.getElementById('v3StageRemaining');
  const progEl = document.getElementById('v3StageProgress');
  const quoteEl = document.getElementById('v3Quote');
  const limEl = document.getElementById('v3YourLimit');
  const limitBanner = document.getElementById('presaleLimits');

  let chainStage = { idx:0, min:PRIVATE_MIN, max:PRIVATE_MAX, price:PRIVATE_PRICE, cap:PRIVATE_CAP, sold:0 };
  try{
    const idx = await presaleContract.methods.currentStage().call();
    const st  = await presaleContract.methods.getStage(idx).call();
    chainStage.idx = Number(idx);
    chainStage.min = fromUnits(web3, web3.utils.toBN(st[1]), usdtDec);
    chainStage.max = fromUnits(web3, web3.utils.toBN(st[2]), usdtDec);
    chainStage.price = Number(st[0])/1e18 || PRIVATE_PRICE;
    chainStage.cap = fromUnits(web3, web3.utils.toBN(st[3]), haipDec);
    chainStage.sold = fromUnits(web3, web3.utils.toBN(st[4]), haipDec);
  }catch{}

  const effMin = Math.max(PRIVATE_MIN, chainStage.min||PRIVATE_MIN);
  const effMax = Math.min(PRIVATE_MAX, chainStage.max>0?chainStage.max:PRIVATE_MAX);

  if(chainStage.idx!==EXPECT_STAGE_IDX){
    stageEl.textContent = `Contract stage: ${chainStage.idx} (not Private)`;
    quoteEl.textContent = 'Stage mismatch — set contract to Private.';
    document.getElementById('purchaseBtn').disabled = true;
    return;
  }

  const sold = chainStage.sold;
  const cap = PRIVATE_CAP;
  const pct = Math.min((sold/cap)*100,100);
  stageEl.textContent = 'Private Presale';
  priceEl.textContent = `${PRIVATE_PRICE.toFixed(5)} USDT / HAIP`;
  soldEl.textContent = `${fmt(sold,2)} / ${fmt(cap,0)} HAIP`;
  remEl.textContent = `${fmt(Math.max(cap-sold,0),0)} HAIP`;
  progEl.style.width = `${pct.toFixed(2)}%`;
  limitBanner.textContent = `Private Presale: Min ${effMin.toFixed(2)} · Max ${effMax.toFixed(2)} USDT · Price ${PRIVATE_PRICE.toFixed(5)} USDT/HAIP`;

  let personalMax = effMax;
  if(connectedAddress){
    try{
      const maxUser = await presaleContract.methods.maxUsdtUserCanBuy(EXPECT_STAGE_IDX, connectedAddress).call();
      const mF = fromUnits(web3, web3.utils.toBN(maxUser), usdtDec);
      personalMax = Math.max(0, Math.min(mF, effMax));
    }catch{}
  }
  limEl.textContent = `${effMin.toFixed(2)}–${personalMax.toFixed(2)}`;
  quoteEl.textContent = `You can still buy up to ${personalMax.toFixed(2)} USDT in this stage.`;
  document.getElementById('purchaseAmount').min = effMin;
  document.getElementById('purchaseAmount').max = personalMax;
}

// -------- CUMPĂRARE --------
async function purchaseTokens(){
  const btn = document.getElementById('purchaseBtn');
  const input = document.getElementById('purchaseAmount');
  const statusEl = document.getElementById('presaleWalletStatus');
  btn.classList.add('loading'); btn.disabled = true;
  try{
    const {idx} = await presaleContract.methods.currentStage().call();
    if(Number(idx)!==EXPECT_STAGE_IDX) throw new Error('Wrong stage active');
    let amount = parseFloat(input.value);
    if(isNaN(amount)||amount<=0) throw new Error('Invalid amount');

    const usdtUnits = toUnits(web3, amount, usdtDec);
    const allowance = await usdtContract.methods.allowance(connectedAddress,PRESALE_ADDRESS).call();
    if(web3.utils.toBN(allowance).lt(usdtUnits)){
      setGasStatus('Approving USDT…');
      await sendWithLowFee(usdtContract.methods.approve(PRESALE_ADDRESS,usdtUnits.toString()),{from:connectedAddress,cap:GAS_CONF.capApprove,label:'Approve'});
    }

    setGasStatus('Buying HAIP…');
    const tx = await sendWithLowFee(presaleContract.methods.buy(usdtUnits.toString()),{from:connectedAddress,cap:GAS_CONF.capBuy,label:'Buy'});
    statusEl.innerHTML = `Success! <a target="_blank" href="https://bscscan.com/tx/${tx.transactionHash}">View on BscScan</a>`;
    input.value = ''; setGasStatus('Done.');
    await refreshStageUI();
  }catch(e){
    statusEl.textContent = 'Error: '+(e.message||'Purchase failed');
  }finally{ btn.classList.remove('loading'); btn.disabled=false; }
}

// -------- DECONENCT --------
function disconnectWallet(){
  connectedAddress=null;
  document.getElementById('presaleWalletStatus').textContent='Wallet not connected';
  document.getElementById('presaleConnectWalletBtn').classList.remove('hidden');
  document.getElementById('presaleDisconnectWalletBtn').classList.add('hidden');
  document.getElementById('purchaseBtn').disabled=true;
}

// -------- EVENTS --------
document.getElementById('presaleConnectWalletBtn').addEventListener('click', connectWallet);
document.getElementById('presaleDisconnectWalletBtn').addEventListener('click', disconnectWallet);
document.getElementById('purchaseBtn').addEventListener('click', purchaseTokens);
</script>
<script>
/* ================== PRIVATE PRESALE – UX ENHANCEMENTS ================== */
(function(){
  const chips = Array.from(document.querySelectorAll('.chip'));
  const amountInput = document.getElementById('purchaseAmount');
  const purchaseBtn = document.getElementById('purchaseBtn');
  const yourLimitEl = document.getElementById('v3YourLimit');
  const sticky = document.getElementById('stickyCta');
  const stickyBtn = document.getElementById('stickyBuyBtn');
  const toast = document.getElementById('toast');

  // helpers
  const showToast = (msg)=>{
    if(!toast) return;
    toast.textContent = msg || 'Done';
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1500);
  };
  const num = (v,def=0)=>{ const n = parseFloat(String(v).replace(',', '.')); return isFinite(n) ? n : def; };

  function currentMin(){
    const a = num(amountInput?.min, NaN);
    if (isFinite(a)) return a;
    // fallback la constantele din PARTEA 2 (dacă există)
    return typeof PRIVATE_MIN !== 'undefined' ? PRIVATE_MIN : 0;
  }
  function currentMax(){
    // dacă avem limită personală în UI, folosește-o
    const ui = yourLimitEl ? num((yourLimitEl.textContent||'').replace(/[^0-9.]/g,''), NaN) : NaN;
    if (isFinite(ui) && ui > 0) return ui;
    const a = num(amountInput?.max, NaN);
    if (isFinite(a)) return a;
    return typeof PRIVATE_MAX !== 'undefined' ? PRIVATE_MAX : Infinity;
  }
  function clampToStage(v){
    const mn = currentMin(), mx = currentMax();
    if (!isFinite(v)) v = mn;
    if (v < mn) v = mn;
    if (v > mx) v = mx;
    return Number(v.toFixed(2));
  }

  // chip logic (+25 / +50 / +75 / Max)
  chips.forEach(ch=>{
    ch.addEventListener('click', ()=>{
      chips.forEach(c=>c.classList.remove('active'));
      ch.classList.add('active');

      const isMax = ch.dataset.max === '1';
      if (isMax) {
        amountInput.value = clampToStage(currentMax()).toFixed(2);
      } else {
        const inc = num(ch.dataset.usdt, 0);
        const cur = num(amountInput.value, 0);
        amountInput.value = clampToStage(cur + inc).toFixed(2);
      }
      amountInput.dispatchEvent(new Event('input'));
    });
  });

  // input validity + button state
  function refreshPurchaseState(){
    const v = num(amountInput.value, NaN);
    const okNum = isFinite(v) && v >= currentMin() && v <= currentMax();
    purchaseBtn.disabled = !(okNum && !!(window.connectedAddress));
  }
  amountInput?.addEventListener('input', refreshPurchaseState);

  // sticky CTA on mobile
  function updateSticky(){
    const mq = window.matchMedia('(max-width: 740px)');
    sticky.style.display = mq.matches ? 'flex' : 'none';
  }
  updateSticky(); window.addEventListener('resize', updateSticky);

  stickyBtn?.addEventListener('click', ()=>{
    document.getElementById('purchaseBtn')?.click();
  });

  // optional: expune copyContract cu toast, dacă există butonul în pagină
  window.copyContract = function(){
    const addr = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
    navigator.clipboard.writeText(addr).then(()=>showToast('Contract copied'));
  };

  // initial kick
  setTimeout(refreshPurchaseState, 400);
  // actualizează starea periodic (ex. după conectare wallet, limită personală etc.)
  const iv = setInterval(refreshPurchaseState, 1500);
  window.addEventListener('beforeunload', ()=>clearInterval(iv));
})();
</script>
