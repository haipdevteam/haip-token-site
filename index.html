<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HAIP Token - Official Site</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
  <style>
    /* TOATE STILURILE TALE – IDENTIC */
    html { scroll-behavior: smooth; overflow-x: hidden; }
    body {
      font-family: 'Orbitron', sans-serif;
      background: url('images/background-cyber.jpg') no-repeat center center fixed;
      background-size: cover; color: #f8f8f8; margin: 0; padding: 0;
    }
    header { background: rgba(31, 40, 51, 0.85); padding: 20px; text-align: center; }
    header h1 { color: #66fcf1; margin: 0; font-size: 1.8rem; }
    .logo-fixed { position: fixed; top: 25px; left: 25px; height: 100px; z-index: 999; cursor: pointer; }
    main {
      padding: 20px; max-width: 900px; margin: auto; background-color: rgba(15, 32, 39, 0.8);
      border-radius: 15px; box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
    }
    .btn {
      background: #66fcf1; color: #0b0c10; padding: 12px 24px; border: none; border-radius: 5px; font-weight: bold;
      text-transform: uppercase; cursor: pointer; margin: 10px 5px; display: inline-block;
      transition: background 0.3s ease, transform 0.3s ease; font-size: 1rem; min-width: 120px;
    }
    .btn:hover { background: #0ff0fc; transform: scale(1.05); }
    .btn:disabled { background: #4a6360; cursor: not-allowed; opacity: 0.7; }
    .btn.loading::after {
      content: ''; position: absolute; width: 16px; height: 16px; top: 50%; right: 10px; transform: translateY(-50%);
      border: 2px solid #0b0c10; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: translateY(-50%) rotate(0deg);} 100% { transform: translateY(-50%) rotate(360deg);} }
    .presale-v3{display:grid; gap:14px;}
    .presale-card{background:rgba(31,40,51,.92); border:1px solid #0ff0fc22; border-radius:14px; padding:14px; box-shadow:0 6px 24px rgba(0,249,255,.15);}
    .presale-head{display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap}
    .presale-title{font-size:1.2rem; color:#66fcf1; margin:0}
    .badge-stage{font-size:.85rem; border:1px solid #0ff0fc44; color:#bff; padding:4px 10px; border-radius:999px}
    .kv{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .kv .box{background:#152028; border:1px solid #0b2a31; border-radius:10px; padding:10px; text-align:center}
    .kv .box b{display:block; color:#66fcf1; margin-bottom:2px}
    .progress{height:12px; background:#132029; border:1px solid #0ff0fc33; border-radius:999px; overflow:hidden}
    .progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,#66fcf1,#0ff0fc); box-shadow:0 0 14px #0ff0fc66 inset; transition:width .6s ease}
    .amount-chips{display:flex; flex-wrap:wrap; gap:8px; justify-content:center}
    .chip{padding:8px 12px; border:1px solid #0ff0fc44; background:#142129; color:#eaffff; border-radius:999px; cursor:pointer; transition:transform .15s ease, border-color .2s ease}
    .chip:hover{transform:translateY(-1px); border-color:#0ff0fc99}
    .chip.active{background:#122; border-color:#0ff0fc; box-shadow:0 0 10px #0ff0fc55 inset}
    .presale-actions .btn{min-width:140px}
    .presale-input input {
      padding: 10px; border: 1px solid #66fcf1; border-radius: 5px; background: #1f2833; color: #f8f8f8; width: 100%; max-width: 300px; margin: 0 auto;
      text-align: center; font-size: 1.1rem;
    }
    .presale-status { color: #ff6b6b; margin: 10px 0; font-weight: bold; }
    @media(min-width: 740px){
      .kv{grid-template-columns:repeat(4,1fr)}
    }
  </style>
</head>
<body>
<a href="#top"><img src="images/haip-logo-transparent.png" alt="HAIP Logo" class="logo-fixed" /></a>
<header id="top">
  <h1>Hp Artificial Intelligence Power (HAIP)</h1>
  <p>The official BEP20 token powering AI innovation on Binance Smart Chain</p>
</header>
<main>
  <!-- TOATE SECȚIUNILE TALE – IDENTIC -->

  <!-- PRIVATE PRESALE SECTION -->
  <section id="presale" class="presale-v3" data-aos="fade-up">
    <h2>Join Private Presale - LIVE NOW</h2>
    <div class="presale-card">
      <div class="presale-head">
        <h3 class="presale-title">Private Presale</h3>
        <span class="badge-stage">LIVE · Stage 0</span>
      </div>
      <div class="kv">
        <div class="box"><b>Price</b><div>0.00009 USDT / HAIP</div></div>
        <div class="box"><b>Your Limit (USDT)</b><div id="v3YourLimit">—</div></div>
        <div class="box"><b>Sold</b><div id="v3StageSold">—</div></div>
        <div class="box"><b>Remaining</b><div id="v3StageRemaining">—</div></div>
      </div>
      <div class="progress"><i id="v3StageProgress"></i></div>
      <p class="quote">Private Presale is LIVE! Min: 3.24 USDT · Max: 90 USDT</p>
    </div>

    <div class="presale-card">
      <div class="presale-status" id="presaleWalletStatus">Wallet not connected</div>
      <div class="live-status" id="gasStatus"></div>
      <div class="presale-limits">PRIVATE PRESALE ACTIVE · Min 3.24 USDT · Max 90 USDT</div>

      <div class="amount-chips">
        <button class="chip active" data-usdt="3.24">3.24</button>
        <button class="chip" data-usdt="10">+10</button>
        <button class="chip" data-usdt="25">+25</button>
        <button class="chip" data-usdt="50">+50</button>
        <button class="chip" data-usdt="0" data-max="1">Max (90)</button>
      </div>

      <div class="presale-input">
        <input type="text" id="purchaseAmount" placeholder="3.24 - 90" value="3.24" />
      </div>

      <div class="presale-actions">
        <button class="btn" id="presaleConnectWalletBtn">Connect Wallet</button>
        <button class="btn hidden" id="presaleDisconnectWalletBtn">Disconnect Wallet</button>
        <button class="btn" id="purchaseBtn" disabled>Purchase HAIP</button>
      </div>
    </div>
  </section>

  <!-- Contact -->
</main>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
window.onload = function() {
  AOS.init();

  const presaleWalletStatus = document.getElementById('presaleWalletStatus');
  const presaleConnectWalletBtn = document.getElementById('presaleConnectWalletBtn');
  const presaleDisconnectWalletBtn = document.getElementById('presaleDisconnectWalletBtn');
  const purchaseBtn = document.getElementById('purchaseBtn');
  const purchaseAmountInput = document.getElementById('purchaseAmount');
  const gasStatus = document.getElementById('gasStatus');

  const HAIP_ADDRESS = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
  const USDT_ADDRESS = '0x55d398326f99059fF775485246999027B3197955';
  const PRESALE_ADDRESS = '0x07e11a90bFea0f38D203f25C26c21de1cD78bFf7';

  const USDT_ABI = [/* allowance, approve, decimals */];
  const PRESALE_ABI = [/* buy, currentStage, getStage, maxUsdtUserCanBuy */];

  let web3, usdtContract, presaleContract;
  let connectedAddress = null, usdtDec = 6;

  const toUnits = (web3, val, dec) => {
    const str = String(val).trim().replace(',', '.');
    const [int, frac = ''] = str.split('.');
    const clean = int + (frac + '0'.repeat(dec)).slice(0, dec);
    return web3.utils.toBN(clean || '0');
  };

  async function initWeb3() {
    if (window.ethereum) web3 = new Web3(window.ethereum);
    else return false;
    usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
    presaleContract = new web3.eth.Contract(PRESALE_ABI, PRESALE_ADDRESS);
    usdtDec = await usdtContract.methods.decimals().call().catch(()=>6);
    return true;
  }

  async function connectWallet() {
    presaleConnectWalletBtn.classList.add('loading'); presaleConnectWalletBtn.disabled = true;
    try {
      if (!await initWeb3()) throw new Error('No wallet');
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      connectedAddress = accounts[0];
      presaleWalletStatus.textContent = `Connected: ${connectedAddress.slice(0,6)}...${connectedAddress.slice(-4)}`;
      presaleConnectWalletBtn.classList.add('hidden');
      presaleDisconnectWalletBtn.classList.remove('hidden');
      purchaseBtn.disabled = false;
      await v3Refresh();
    } catch (err) {
      presaleWalletStatus.textContent = `Error: ${err.message}`;
    } finally {
      presaleConnectWalletBtn.classList.remove('loading'); presaleConnectWalletBtn.disabled = false;
    }
  }

  async function v3Refresh() {
    if (!connectedAddress) return;
    try {
      const maxUser = await presaleContract.methods.maxUsdtUserCanBuy(0, connectedAddress).call();
      const maxFloat = Number(web3.utils.fromWei(maxUser, 'mwei'));
      document.getElementById('v3YourLimit').textContent = maxFloat.toFixed(2);
    } catch {}
  }

  async function purchaseTokens() {
    purchaseBtn.classList.add('loading'); purchaseBtn.disabled = true;
    try {
      if (!connectedAddress) throw new Error('Connect wallet');
      let raw = purchaseAmountInput.value.trim().replace(',', '.');
      if (!/^\d+\.?\d*$/.test(raw) || parseFloat(raw) < 3.24) {
        purchaseAmountInput.value = '3.24';
        throw new Error('Enter valid amount (3.24 - 90)');
      }
      let amount = parseFloat(raw);
      if (amount > 90) amount = 90;

      const usdtUnits = toUnits(web3, amount, usdtDec);
      if (usdtUnits.isZero()) throw new Error('Invalid amount');

      const allowance = await usdtContract.methods.allowance(connectedAddress, PRESALE_ADDRESS).call();
      if (web3.utils.toBN(allowance).lt(usdtUnits)) {
        gasStatus.textContent = 'Approving...';
        await usdtContract.methods.approve(PRESALE_ADDRESS, usdtUnits.toString()).send({ from: connectedAddress });
      }

      gasStatus.textContent = 'Buying...';
      const tx = await presaleContract.methods.buy(usdtUnits.toString()).send({ from: connectedAddress });
      presaleWalletStatus.innerHTML = `Success! <a href="https://bscscan.com/tx/${tx.transactionHash}" target="_blank">View Tx</a>`;
      purchaseAmountInput.value = '';
    } catch (err) {
      presaleWalletStatus.textContent = `Error: ${err.message || 'Failed'}`;
    } finally {
      purchaseBtn.classList.remove('loading'); purchaseBtn.disabled = false;
    }
  }

  presaleConnectWalletBtn.onclick = connectWallet;
  presaleDisconnectWalletBtn.onclick = () => location.reload();
  purchaseBtn.onclick = purchaseTokens;

  // INPUT VALIDATION
  purchaseAmountInput.oninput = function() {
    let val = this.value.replace(/[^0-9.,]/g, '').replace(',', '.');
    if (val === '' || val === '.') val = '3.24';
    const num = parseFloat(val);
    if (isNaN(num) || num < 3.24) val = '3.24';
    if (num > 90) val = '90.00';
    this.value = parseFloat(val).toFixed(2);
    purchaseBtn.disabled = num < 3.24 || num > 90;
  };

  // CHIPS
  document.querySelectorAll('.chip').forEach(ch => {
    ch.onclick = () => {
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
      ch.classList.add('active');
      let val = parseFloat(purchaseAmountInput.value) || 0;
      if (ch.dataset.max === '1') {
        const lim = document.getElementById('v3YourLimit').textContent;
        val = parseFloat(lim) || 90;
      } else {
        val += parseFloat(ch.dataset.usdt);
      }
      if (val > 90) val = 90;
      purchaseAmountInput.value = val.toFixed(2);
      purchaseAmountInput.dispatchEvent(new Event('input'));
    };
  });

  // INIT
  (async () => {
    if (window.ethereum) await initWeb3();
  })();
};
</script>
</body>
</html>
