<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="HAIP Token: Empowering AI and blockchain innovation through decentralized ecosystems.">
  <title>HAIP Token - Official Site</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
  <style>
    html { scroll-behavior: smooth; overflow-x: hidden; }
    body {
      font-family: 'Orbitron', sans-serif;
      background: url('images/background-cyber.jpg') no-repeat center center fixed;
      background-size: cover; color: #f8f8f8; margin: 0; padding: 0; min-width: 100%; overflow-x: hidden;
    }
    header { background: rgba(31, 40, 51, 0.85); padding: 20px; text-align: center; position: relative; }
    header h1 { color: #66fcf1; margin: 0; font-size: 1.8rem; }
    .logo-fixed { position: fixed; top: 25px; left: 25px; height: 100px; z-index: 999; cursor: pointer; transition: transform 0.3s ease; }
    .logo-fixed:hover { transform: scale(1.1); }
    main {
      padding: 20px; max-width: 900px; margin: auto; background-color: rgba(15, 32, 39, 0.8);
      border-radius: 15px; box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
    }
    section { margin-bottom: 20px; }
    h2 { color: #45a29e; margin-bottom: 10px; font-size: 1.5rem; }
    a { color: #66fcf1; text-decoration: none; }
    .contract {
      background: #1f2833; padding: 15px 20px; border-radius: 10px; word-break: break-word; font-family: monospace;
      font-size: 0.9rem; color: #66fcf1; text-align: center; border: 1px solid #0ff0fc; box-shadow: 0 0 12px rgba(0, 255, 252, 0.15);
      max-width: 100%; overflow-wrap: break-word; margin-bottom: 10px;
    }
    .btn {
      background: #66fcf1; color: #0b0c10; padding: 12px 24px; border: none; border-radius: 5px; font-weight: bold;
      text-transform: uppercase; cursor: pointer; margin-top: 10px; margin-right: 10px; display: inline-block;
      transition: background 0.3s ease, transform 0.3s ease; position: relative; font-size: 1rem; min-width: 120px; touch-action: manipulation;
    }
    .btn:hover { background: #0ff0fc; transform: scale(1.05); }
    .btn:disabled { background: #4a6360; cursor: not-allowed; opacity: 0.7; }
    .btn.loading::after {
      content: ''; position: absolute; width: 16px; height: 16px; top: 50%; right: 10px; transform: translateY(-50%);
      border: 2px solid #0b0c10; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: translateY(-50%) rotate(0deg);} 100% { transform: translateY(-50%) rotate(360deg);} }
    .presale-stage {
      background: rgba(31, 40, 51, 0.7); border-left: 4px solid #66fcf1; padding: 15px; margin-bottom: 10px; border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 249, 255, 0.1); animation: fadeInUp 1s ease both; transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease; cursor: pointer;
    }
    .presale-stage:hover { transform: scale(1.02); box-shadow: 0 0 25px rgba(0, 249, 255, 0.3); background: rgba(31, 40, 51, 0.9); }
    .presale-stage h3 { margin-top: 0; color: #0ff0fc; font-size: 1.2rem; }
    .presale-stage p { margin: 5px 0; color: #f0f0f0; font-size: 0.9rem; }
    .countdown {
      text-align: center; font-size: 1.5rem; color: #0ff0fc; margin: 20px auto; font-weight: bold; text-shadow: 0 0 15px #0ff0fc;
      border: 2px solid #0ff0fc; border-radius: 10px; padding: 15px; width: fit-content; background: rgba(0, 255, 255, 0.05);
      animation: glowPulse 2s ease-in-out infinite;
    }
    .newsletter-form { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
    .newsletter-form input {
      padding: 10px; border: 1px solid #66fcf1; border-radius: 5px; background: #1f2833; color: #f8f8f8; width: 100%; box-sizing: border-box;
    }
    .newsletter-form button { background: #66fcf1; color: #0b0c10; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    .token-details { display: grid; grid-template-columns: repeat(3, minmax(200px, 1fr)); gap: 15px; margin: 10px 0; }
    .token-details div {
      background: #1f2833; padding: 15px; border-radius: 10px; text-align: center; color: #f8f8f8; border: 2px solid #1f2833;
      transition: border-color 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; align-items: center;
    }
    .token-details div strong { color: #66fcf1; display: block; margin-bottom: 5px; }
    .token-details div:hover { border-color: #0ff0fc; box-shadow: 0 0 15px #0ff0fc, 0 0 30px rgba(0, 255, 252, 0.5); }
    @keyframes floatLogo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes glowPulse { 0%, 100% { box-shadow: 0 0 10px #0ff0fc, 0 0 20px #0ff0fc; } 50% { box-shadow: 0 0 20px #0ff0fc, 0 0 30px #0ff0fc; } }
    canvas#tokenomicsChart { display: block; max-width: 300px; width: 100%; margin: 0 auto; }
    .tokenomics-section p:last-child { margin-bottom: 5px; }
    .roadmap-section { margin-top: 5px; }
    .tokenomics-container .chart-legend { font-size: 1rem; text-align: center; padding: 0 10px; }
    .tokenomics-container .chart-legend p { margin: 5px 0; }
    .staking-dashboard, .presale-dashboard {
      background: rgba(31, 40, 51, 0.9); border-radius: 10px; padding: 15px; box-shadow: 0 0 20px rgba(0, 249, 255, 0.2);
      text-align: center; margin-bottom: 20px;
    }
    .staking-dashboard h2, .presale-dashboard h2 { color: #66fcf1; margin-bottom: 15px; font-size: 1.5rem; }
    .staking-status, .presale-status { font-size: 1rem; color: #f0f0f0; margin-bottom: 15px; word-break: break-word; }
    .staking-balance, .presale-limits { font-size: 1.2rem; color: #0ff0fc; margin-bottom: 20px; text-shadow: 0 0 10px #0ff0fc; }
    .staking-actions, .presale-actions { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
    .staking-input, .presale-input { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
    .staking-input input, .presale-input input {
      padding: 10px; border: 1px solid #66fcf1; border-radius: 5px; background: #1f2833; color: #f8f8f8; width: 100%; max-width: 300px; margin: 0 auto; box-sizing: border-box;
    }
    .staking-input input::placeholder, .presale-input input::placeholder { color: #a0a0a0; }
    .staking-input.hidden, .presale-input.hidden { display: none; }
    /* Progress bar profesional */
    .stage-widget { text-align: left; margin-bottom: 15px; }
    .stage-title { font-size: 1.2rem; color: #0ff0fc; margin: 4px 0 10px; }
    .stage-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
    .stage-kv { background:#1f2833; border:1px solid #0b2a31; border-radius:8px; padding:10px; }
    .stage-kv b { color:#66fcf1; }
    .progress-wrap { background:#132029; border:1px solid #0ff0fc33; border-radius:999px; height:14px; overflow:hidden; }
    .progress-fill { height:100%; width:0%; background:linear-gradient(90deg,#66fcf1,#0ff0fc); box-shadow:0 0 15px #0ff0fc66 inset; transition:width .6s ease; }
    .muted { opacity:.85; font-size:.95rem; }
    @media (max-width: 600px) {
      header h1 { font-size: 1.5rem; } h2 { font-size: 1.2rem; }
      .logo-fixed { height: 80px; top: 15px; left: 15px; }
      main { padding: 15px; } .btn { padding: 10px 20px; font-size: 0.9rem; min-width: 100px; }
      .presale-stage h3 { font-size: 1rem; } .presale-stage p { font-size: 0.8rem; }
      .countdown { font-size: 1.2rem; padding: 10px; }
      .token-details { grid-template-columns: 1fr; gap: 10px; }
      .token-details div { padding: 10px; } canvas#tokenomicsChart { max-width: 250px; }
      .tokenomics-container .chart-legend { font-size: 0.9rem; }
      .staking-dashboard, .presale-dashboard { padding: 10px; }
      .staking-status, .presale-status { font-size: 0.9rem; }
      .staking-balance, .presale-limits { font-size: 1rem; }
      .staking-actions, .presale-actions { flex-direction: column; gap: 10px; }
      .staking-actions .btn, .presale-actions .btn { width: 100%; max-width: 300px; }
      .staking-input input, .presale-input input { width: 100%; max-width: none; }
      .stage-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <a href="#top">
    <div class="logo-fixed"></div>
  </a>
  <header id="top">
    <h1>Hp Artificial Intelligence Power (HAIP)</h1>
    <p>The official BEP20 token powering AI innovation on Binance Smart Chain</p>
  </header>
  <main>
    <section data-aos="fade-up">
      <h2>About HAIP</h2>
      <p>HAIP is a BEP-20 token on Binance Smart Chain designed to fund and integrate artificial intelligence with decentralized finance (DeFi) and Web3 ecosystems. Leveraging smart contracts, Chainlink oracles, and IPFS storage, HAIP empowers AI-driven dApps and community governance through a decentralized DAO.</p>
      <a class="btn" href="https://pancakeswap.finance/swap?outputCurrency=0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29" target="_blank">Buy on PancakeSwap</a>
      <a class="btn" href="#presale">Join Presale</a>
      <a class="btn" href="#staking">HAIP Staking</a>
    </section>
    <section data-aos="fade-up">
      <h2>Token Details</h2>
      <div class="token-details">
        <div><strong>Token Name</strong> Hp Artificial Intelligence Power</div>
        <div><strong>Symbol</strong> HAIP</div>
        <div><strong>Decimals</strong> 18</div>
        <div><strong>Total Supply</strong> 18,000,000,000 HAIP</div>
        <div><strong>Network</strong> Binance Smart Chain (BEP20)</div>
        <div>
          <strong>Contract</strong>
          <div class="contract">0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29</div>
          <button class="btn" onclick="copyContract()">Copy Contract</button>
        </div>
      </div>
    </section>
    <section data-aos="fade-up" class="tokenomics-section">
      <h2>Tokenomics</h2>
      <p><strong>Total Supply:</strong> 18,000,000,000 HAIP</p>
      <ul>
        <li><strong>Presale:</strong> 54% (9.72B HAIP, allocated across private and public stages)</li>
        <li><strong>DEX Liquidity:</strong> 27% (4.86B HAIP, for trading on PancakeSwap)</li>
        <li><strong>Development:</strong> 10% (1.8B HAIP, vested over 2 years)</li>
        <li><strong>Partners:</strong> 9% (1.62B HAIP, for strategic collaborations)</li>
      </ul>
      <p><strong>Vesting:</strong> Team and partner tokens vested over 2 years to ensure long-term commitment.</p>
    </section>
    <div class="tokenomics-container">
      <div class="chart-legend">
        <p><span style="color: #66fcf1;">¦</span> Presale (54%)</p>
        <p><span style="color: #0ff0fc;">¦</span> DEX Liquidity (27%)</p>
        <p><span style="color: #2c3e50;">¦</span> Development (10%)</p>
        <p><span style="color: #08fdd8;">¦</span> Partners (9%)</p>
      </div>
      <canvas id="tokenomicsChart" class="tokenomics-chart"></canvas>
    </div>
    <section data-aos="fade-up" class="roadmap-section">
      <h2>Roadmap</h2>
      <p>Updated June 2025 to reflect current development timeline.</p>
      <ul>
        <li><strong>Q3 2025:</strong> Initiation of private presale, token deployment, smart contract audits</li>
        <li><strong>Q4 2025:</strong> Public presale, TrustWallet integration, open-source code release on GitHub</li>
        <li><strong>Q1 2026:</strong> Community DAO setup, staking mechanism launch, strategic partnerships with AI and DeFi projects</li>
        <li><strong>Q2 2026:</strong> AI dApp beta launch, Chainlink oracles integration</li>
        <li><strong>Q3 2026:</strong> Enhanced DAO features, pilot launch of AI model bounty marketplace</li>
        <li><strong>Q4 2026:</strong> Launchpad for AI startups funded in HAIP</li>
      </ul>
    </section>
    <section data-aos="fade-up">
      <h2>Presale Countdown</h2>
      <div class="countdown" id="countdown"></div>
    </section>
    <section data-aos="fade-up">
      <h2>Presale Stages</h2>
      <div class="presale-stage" style="animation-delay: 0.2s">
        <h3>Private Presale</h3>
        <p>Allocation: <strong>2% (360M HAIP)</strong></p>
        <p>Price: <strong>0.0018 USDT</strong> per HAIP</p>
        <p>Min per user: <strong>5.4 USDT</strong> (3,000 HAIP)</p>
        <p>Max per user: <strong>108 USDT</strong> (60,000 HAIP)</p>
      </div>
      <div class="presale-stage" style="animation-delay: 0.4s">
        <h3>Public Presale - Stage 1</h3>
        <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
        <p>Price: <strong>0.0036 USDT</strong> per HAIP</p>
        <p>Min per user: <strong>9.72 USDT</strong> (2,700 HAIP)</p>
        <p>Max per user: <strong>194.4 USDT</strong> (54,000 HAIP)</p>
      </div>
      <div class="presale-stage" style="animation-delay: 0.6s">
        <h3>Public Presale - Stage 2</h3>
        <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
        <p>Price: <strong>0.0108 USDT</strong> per HAIP</p>
        <p>Min per user: <strong>19.44 USDT</strong> (1,800 HAIP)</p>
        <p>Max per user: <strong>388.8 USDT</strong> (36,000 HAIP)</p>
      </div>
      <div class="presale-stage" style="animation-delay: 0.8s">
        <h3>Public Presale - Stage 3</h3>
        <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
        <p>Price: <strong>0.0324 USDT</strong> per HAIP</p>
        <p>Min per user: <strong>29.16 USDT</strong> (900 HAIP)</p>
        <p>Max per user: <strong>874.8 USDT</strong> (27,000 HAIP)</p>
      </div>
      <div class="presale-stage" style="animation-delay: 1s">
        <h3>Public Presale - Stage 4</h3>
        <p>Allocation: <strong>13% (2.34B HAIP)</strong></p>
        <p>Price: <strong>0.0972 USDT</strong> per HAIP</p>
        <p>Min per user: <strong>32.36 USDT</strong> (333 HAIP)</p>
        <p>Max per user: <strong>2,361.96 USDT</strong> (24,300 HAIP)</p>
      </div>
    </section>
    <section id="presale" data-aos="fade-up" data-aos-delay="100">
      <h2>Join Presale Now</h2>
      <!-- WIDGET LIVE STAGE -->
      <div class="presale-dashboard" id="stageWidget">
        <div class="stage-widget">
          <div class="stage-title" id="stageTitle">Stage —</div>
          <div class="stage-grid">
            <div class="stage-kv"><b>Price</b><div id="stagePrice">—</div></div>
            <div class="stage-kv"><b>Your Limit (USDT)</b><div id="yourLimit">—</div></div>
            <div class="stage-kv"><b>Sold</b><div id="stageSold">—</div></div>
            <div class="stage-kv"><b>Remaining</b><div id="stageRemaining">—</div></div>
          </div>
          <div class="progress-wrap"><div class="progress-fill" id="stageProgress"></div></div>
          <div class="muted" id="stageHint" style="margin-top:8px;">Connect your wallet to see your current limit.</div>
        </div>
      </div>
      <!-- /WIDGET -->
      <div class="presale-dashboard">
        <div class="presale-status" id="presaleWalletStatus">Wallet not connected</div>
        <div class="presale-limits" id="presaleLimits">Public Presale - Stage 1 Limits: Min 9.72 USDT (2,700 HAIP), Max 194.4 USDT (54,000 HAIP)</div>
        <div class="presale-input" id="purchaseInput" class="hidden">
          <input type="number" id="purchaseAmount" placeholder="Amount to spend (USDT)" min="9.72" max="194.4" step="0.01">
        </div>
        <div class="presale-actions">
          <button class="btn" id="presaleConnectWalletBtn">Connect Wallet</button>
          <button class="btn hidden" id="presaleDisconnectWalletBtn">Disconnect Wallet</button>
          <button class="btn" id="purchaseBtn" disabled>Purchase</button>
        </div>
      </div>
    </section>
    <section id="staking" data-aos="fade-up" data-aos-delay="200">
      <h2>HAIP Staking (Dashboard)</h2>
      <div class="staking-dashboard">
        <div class="staking-status" id="walletStatus">Wallet not connected</div>
        <div class="staking-balance" id="walletBalance">Balance: -- HAIP</div>
        <div class="staking-input" id="transferInput" class="hidden">
          <input type="number" id="transferAmount" placeholder="Amount to transfer (HAIP)" min="0" step="0.000000000000000001">
          <input type="text" id="transferAddress" placeholder="Recipient contract address (0x...)">
        </div>
        <div class="staking-actions">
          <button class="btn" id="connectWalletBtn">Connect Wallet</button>
          <button class="btn hidden" id="disconnectWalletBtn">Disconnect Wallet</button>
          <button class="btn" id="transferBtn" disabled>Transfer</button>
        </div>
      </div>
    </section>
    <section data-aos="fade-up">
      <h2>Contact Us</h2>
      <p>Join our community or reach out for inquiries and collaborations.</p>
      <ul>
        <li>Email: <a href="mailto:contact@haip-token.org">contact@haip-token.org</a></li>
        <li>Telegram: <a href="https://t.me/haipcommunity" target="_blank">@haipcommunity</a></li>
        <li>Twitter: <a href="https://twitter.com/haiptoken" target="_blank">@haiptoken</a></li>
        <li>Discord: <a href="https://discord.gg/haip" target="_blank">HAIP Community</a></li>
      </ul>
      <div class="newsletter-form">
        <input type="email" placeholder="Enter your email for updates" required>
        <button type="submit">Subscribe</button>
      </div>
    </section>
    <section data-aos="fade-up">
      <h2>Resources</h2>
      <ul>
        <li><a href="https://bscscan.com/token/0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29" target="_blank">View on BscScan</a></li>
        <li><a href="https://github.com/Darck120579/assets" target="_blank">GitHub Repository (Coming Q4 2025)</a></li>
      </ul>
    </section>
    <section data-aos="fade-up">
      <h2>Legal Disclaimer</h2>
      <p>HAIP Token is a utility token, not a security or equity in any entity. Participants must comply with local regulations before acquiring or transacting with HAIP. All smart contracts undergo independent public audits prior to deployment (Q3 2025). KYC and AML procedures are enforced for presale participants and regulated partner platforms to ensure compliance with international regulatory standards.</p>
    </section>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    AOS.init({ duration: 1000 });
    // Countdown logic
    const countdown = document.getElementById('countdown');
    const launchDate = new Date('2025-09-01T00:00:00Z').getTime(); // Set to September 1, 2025, 00:00 UTC
    const updateCountdown = () => {
      const now = new Date().getTime();
      const distance = launchDate - now;
      if (distance <= 0) {
        countdown.innerHTML = "Presale is Live!";
        countdown.style.animation = 'none';
        countdown.style.border = '2px solid #66fcf1';
        return;
      }
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      countdown.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    };
    setInterval(updateCountdown, 1000);
    updateCountdown();
    // Tokenomics chart
    const ctx = document.getElementById('tokenomicsChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Presale (54%)', 'DEX Liquidity (27%)', 'Development (10%)', 'Partners (9%)'],
        datasets: [{ data: [54, 27, 10, 9], backgroundColor: ['#66fcf1', '#0ff0fc', '#2c3e50', '#08fdd8'], borderColor: '#0b0c10', borderWidth: 2, hoverOffset: 20 }]
      },
      options: {
        responsive: true, maintainAspectRatio: true,
        animation: { animateScale: true, animateRotate: true },
        plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1f2833', titleColor: '#fff', bodyColor: '#fff', borderColor: '#66fcf1', borderWidth: 1, cornerRadius: 6, padding: 10 } }
      }
    });
    // ---------------------- Web3 & Presale Logic ----------------------
    const walletStatus = document.getElementById('walletStatus');
    const walletBalance = document.getElementById('walletBalance');
    const connectWalletBtn = document.getElementById('connectWalletBtn');
    const disconnectWalletBtn = document.getElementById('disconnectWalletBtn');
    const transferBtn = document.getElementById('transferBtn');
    const transferInput = document.getElementById('transferInput');
    const transferAmountInput = document.getElementById('transferAmount');
    const transferAddressInput = document.getElementById('transferAddress');
    const presaleWalletStatus = document.getElementById('presaleWalletStatus');
    const presaleConnectWalletBtn = document.getElementById('presaleConnectWalletBtn');
    const presaleDisconnectWalletBtn = document.getElementById('presaleDisconnectWalletBtn');
    const purchaseBtn = document.getElementById('purchaseBtn');
    const purchaseInput = document.getElementById('purchaseInput');
    const purchaseAmountInput = document.getElementById('purchaseAmount');
    const presaleLimits = document.getElementById('presaleLimits');
    // Stage widget elements
    const stageTitle = document.getElementById('stageTitle');
    const stagePrice = document.getElementById('stagePrice');
    const stageSold = document.getElementById('stageSold');
    const stageRemaining = document.getElementById('stageRemaining');
    const stageProgress = document.getElementById('stageProgress');
    const stageHint = document.getElementById('stageHint');
    // Contract details (BSC mainnet)
    const HAIP_ADDRESS = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
    const USDT_ADDRESS = '0x55d398326f99059fF775485246999027B3197955'; // USDT
    const PRESALE_ADDRESS = '0x07e11a90bFea0f38D203f25C26c21de1cD78bFf7';
    const HAIP_ABI = [
      {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
    ];
    const USDT_ABI = [
      {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}
    ];
    // ABI minim pentru presale
    const PRESALE_ABI = [
      {"inputs":[{"internalType":"uint256","name":"usdtAmount","type":"uint256"}],"name":"buy","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"currentStage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"}],"name":"getStage","outputs":[
          {"internalType":"uint256","name":"priceNum","type":"uint256"},
          {"internalType":"uint256","name":"minUsdt","type":"uint256"},
          {"internalType":"uint256","name":"maxUsdt","type":"uint256"},
          {"internalType":"uint256","name":"capTokens","type":"uint256"},
          {"internalType":"uint256","name":"soldTokens","type":"uint256"}
      ],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"},{"internalType":"address","name":"user","type":"address"}],"name":"maxUsdtUserCanBuy","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"stageIdx","type":"uint256"},{"internalType":"uint256","name":"usdtAmount","type":"uint256"}],"name":"quoteTokens","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];
    let web3, haipContract, usdtContract, presaleContract;
    let connectedAddress = null, haipDec = 18, usdtDec = 18;
    const fmt = (n,d=2)=>Number(n).toLocaleString(undefined,{maximumFractionDigits:d});
    const toUnits = (web3, val, dec) => {
      const bn = web3.utils.toBN(Math.floor((+val) * 1e6));
      const scale = web3.utils.toBN(10).pow(web3.utils.toBN(dec - 6));
      return bn.mul(scale);
    };
    const fromUnits = (web3, bn, dec) => {
      const scale = web3.utils.toBN(10).pow(web3.utils.toBN(dec));
      const s = bn.toString();
      const pad = s.padStart(dec+1, '0');
      const intPart = pad.slice(0, -dec);
      const fracPart = pad.slice(-dec, -dec+6);
      return Number(`${intPart}.${fracPart}`);
    };
    const initWeb3 = async () => {
      let attempts = 0; const maxAttempts = 15; const retryDelay = 2000;
      while (attempts < maxAttempts) {
        if (window.ethereum) {
          try {
            web3 = new Web3(window.ethereum);
            haipContract = new web3.eth.Contract(HAIP_ABI, HAIP_ADDRESS);
            usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
            presaleContract = new web3.eth.Contract(PRESALE_ABI, PRESALE_ADDRESS);
            try { haipDec = await haipContract.methods.decimals().call(); } catch {}
            try { usdtDec = await usdtContract.methods.decimals().call(); } catch {}
            return true;
          } catch (e) { attempts++; await new Promise(r=>setTimeout(r, retryDelay)); }
        } else if (window.web3) {
          try {
            web3 = new Web3(window.web3.currentProvider);
            haipContract = new web3.eth.Contract(HAIP_ABI, HAIP_ADDRESS);
            usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
            presaleContract = new web3.eth.Contract(PRESALE_ABI, PRESALE_ADDRESS);
            return true;
          } catch (e) { attempts++; await new Promise(r=>setTimeout(r, retryDelay)); }
        } else { attempts++; await new Promise(r=>setTimeout(r, retryDelay)); }
      }
      const msg = 'No wallet provider detected. Please install <a href="https://metamask.io/download" target="_blank">MetaMask</a> or <a href="https://trustwallet.com/download" target="_blank">Trust Wallet</a>.';
      walletStatus.innerHTML = msg; presaleWalletStatus.innerHTML = msg; return false;
    };
    const checkNetwork = async () => {
      try {
        const chainId = await web3.eth.getChainId();
        if (chainId !== 56) {
          try {
            await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] });
            return true;
          } catch (switchError) {
            if (switchError.code === 4902) {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{ chainId:'0x38', chainName:'Binance Smart Chain', nativeCurrency:{name:'BNB',symbol:'BNB',decimals:18},
                  rpcUrls:['https://bsc-dataseed.binance.org/'], blockExplorerUrls:['https://bscscan.com']}]
              });
              return true;
            }
            walletStatus.textContent = 'Failed to switch to Binance Smart Chain.';
            presaleWalletStatus.textContent = 'Failed to switch to Binance Smart Chain.';
            return false;
          }
        }
        return true;
      } catch {
        walletStatus.textContent = 'Error checking network.'; presaleWalletStatus.textContent = 'Error checking network.'; return false;
      }
    };
    const detectWalletType = () => {
      if (window.ethereum?.isMetaMask) return 'MetaMask';
      if (window.ethereum?.isTrust) return 'Trust Wallet';
      if (window.ethereum?.isCoinbaseWallet) return 'Coinbase Wallet';
      if (window.ethereum) return 'Web3 Wallet';
      if (window.web3) return 'Legacy Web3 Wallet';
      return 'Unknown Wallet';
    };
    const connectWallet = async () => {
      connectWalletBtn.classList.add('loading'); presaleConnectWalletBtn.classList.add('loading');
      connectWalletBtn.disabled = true; presaleConnectWalletBtn.disabled = true;
      try {
        if (!await initWeb3()) throw new Error('No wallet provider detected.');
        if (!await checkNetwork()) throw new Error('Wrong network');
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        if (accounts.length === 0) throw new Error('No accounts authorized.');
        connectedAddress = accounts[0];
        const walletType = detectWalletType();
        const balance = await haipContract.methods.balanceOf(connectedAddress).call();
        walletStatus.textContent = `Connected with ${walletType}: ${connectedAddress.slice(0,6)}...${connectedAddress.slice(-4)}`;
        presaleWalletStatus.textContent = `Connected with ${walletType}: ${connectedAddress.slice(0,6)}...${connectedAddress.slice(-4)}`;
        walletBalance.textContent = `Balance: ${fromUnits(web3, web3.utils.toBN(balance), haipDec).toFixed(6)} HAIP`;
        connectWalletBtn.classList.add('hidden'); presaleConnectWalletBtn.classList.add('hidden');
        disconnectWalletBtn.classList.remove('hidden'); presaleDisconnectWalletBtn.classList.remove('hidden');
        transferBtn.disabled = false; purchaseBtn.disabled = false;
        purchaseInput.classList.remove('hidden');
        await refreshPresaleLimits();
        await refreshStageUI();
        window.ethereum.on('accountsChanged', ()=>location.reload());
        window.ethereum.on('chainChanged', ()=>location.reload());
      } catch (error) {
        walletStatus.textContent = `Error: ${error.message || 'Failed to connect wallet'}`;
        presaleWalletStatus.textContent = `Error: ${error.message || 'Failed to connect wallet'}`;
      } finally {
        connectWalletBtn.classList.remove('loading'); presaleConnectWalletBtn.classList.remove('loading');
        connectWalletBtn.disabled = false; presaleConnectWalletBtn.disabled = false;
      }
    };
    const refreshPresaleLimits = async () => {
      try {
        const idx = await presaleContract.methods.currentStage().call();
        const st = await presaleContract.methods.getStage(idx).call();
        const minU = fromUnits(web3, web3.utils.toBN(st.minUsdt || st[1]), usdtDec);
        const maxU = fromUnits(web3, web3.utils.toBN(st.maxUsdt || st[2]), usdtDec);
        const priceNum = Number(st.priceNum || st[0]) / 10000;
        presaleLimits.textContent = `Public Presale - Stage ${Number(idx)+1} Limits: Min ${minU.toFixed(2)} USDT, Max ${maxU.toFixed(2)} USDT · Price ${priceNum.toFixed(4)} USDT/HAIP`;
        purchaseAmountInput.min = minU; purchaseAmountInput.max = maxU;
      } catch {}
    };
    // === WIDGET: Stage info live ===
    const refreshStageUI = async () => {
      try {
        const idx = await presaleContract.methods.currentStage().call();
        const st = await presaleContract.methods.getStage(idx).call();
        const price = (Number(st.priceNum || st[0]) / 10000).toFixed(4);
        const sold = fromUnits(web3, web3.utils.toBN(st.soldTokens || st[4]), haipDec);
        const cap = fromUnits(web3, web3.utils.toBN(st.capTokens || st[3]), haipDec);
        const remaining = Math.max(cap - sold, 0);
        const pct = cap > 0 ? Math.min((sold / cap) * 100, 100) : 0;
        stageTitle.textContent = `Public Presale — Stage ${Number(idx)+1}`;
        stagePrice.textContent = `${price} USDT / HAIP`;
        stageSold.textContent = `${fmt(sold, 2)} / ${fmt(cap, 2)} HAIP`;
        stageRemaining.textContent = `${fmt(remaining, 2)} HAIP`;
        stageProgress.style.width = `${pct.toFixed(2)}%`;
        if (connectedAddress) {
          try {
            const maxUser = await presaleContract.methods.maxUsdtUserCanBuy(idx, connectedAddress).call();
            const maxUserFloat = fromUnits(web3, web3.utils.toBN(maxUser), usdtDec);
            stageHint.textContent = `You can still buy up to ${maxUserFloat.toFixed(2)} USDT in this stage.`;
            document.getElementById('yourLimit').textContent = `${maxUserFloat.toFixed(2)}`;
          } catch {
            stageHint.textContent = `Connect your wallet to see your current limit.`;
            document.getElementById('yourLimit').textContent = `—`;
          }
        } else {
          stageHint.textContent = `Connect your wallet to see your current limit.`;
          document.getElementById('yourLimit').textContent = `—`;
        }
      } catch (e) {
        // fallback UI
        stageTitle.textContent = `Public Presale — Stage —`;
      }
    };
    // auto refresh every 20s
    setInterval(()=>{ if (presaleContract) refreshStageUI(); }, 20000);
    const updateWalletUI = async () => {
      if (!connectedAddress) return;
      const walletType = (window.ethereum?.isMetaMask && 'MetaMask') || 'Wallet';
      const balance = await haipContract.methods.balanceOf(connectedAddress).call();
      walletStatus.textContent = `Connected with ${walletType}: ${connectedAddress.slice(0, 6)}...${connectedAddress.slice(-4)}`;
      presaleWalletStatus.textContent = `Connected with ${walletType}: ${connectedAddress.slice(0, 6)}...${connectedAddress.slice(-4)}`;
      walletBalance.textContent = `Balance: ${fromUnits(web3, web3.utils.toBN(balance), haipDec).toFixed(6)} HAIP`;
    };
    const disconnectWallet = () => {
      connectedAddress = null;
      walletStatus.textContent = 'Wallet not connected'; presaleWalletStatus.textContent = 'Wallet not connected';
      walletBalance.textContent = 'Balance: -- HAIP';
      connectWalletBtn.classList.remove('hidden'); disconnectWalletBtn.classList.add('hidden');
      presaleConnectWalletBtn.classList.remove('hidden'); presaleDisconnectWalletBtn.classList.add('hidden');
      transferBtn.disabled = true; purchaseBtn.disabled = true; transferInput.classList.add('hidden'); purchaseInput.classList.add('hidden');
      transferAmountInput.value = ''; transferAddressInput.value = ''; purchaseAmountInput.value = '';
      refreshStageUI();
    };
    const transferTokens = async () => {
      if (!transferInput.classList.contains('hidden')) {
        transferBtn.classList.add('loading'); transferBtn.disabled = true;
        try {
          if (!web3 || !haipContract || !connectedAddress) throw new Error('Wallet not connected');
          const amount = parseFloat(transferAmountInput.value); const recipient = transferAddressInput.value;
          if (isNaN(amount) || amount <= 0) throw new Error('Invalid amount');
          if (!web3.utils.isAddress(recipient)) throw new Error('Invalid recipient address');
          const weiAmount = toUnits(web3, amount, haipDec);
          await haipContract.methods.transfer(recipient, weiAmount.toString()).send({ from: connectedAddress });
          walletStatus.textContent = `Transferred ${amount} HAIP to ${recipient.slice(0, 6)}...${recipient.slice(-4)}`;
          presaleWalletStatus.textContent = `Transferred ${amount} HAIP to ${recipient.slice(0, 6)}...${recipient.slice(-4)}`;
          const balance = await haipContract.methods.balanceOf(connectedAddress).call();
          walletBalance.textContent = `Balance: ${fromUnits(web3, web3.utils.toBN(balance), haipDec).toFixed(6)} HAIP`;
          transferInput.classList.add('hidden'); transferAmountInput.value = ''; transferAddressInput.value = '';
        } catch (error) {
          walletStatus.textContent = `Error: ${error.message || 'Transfer failed'}`;
          presaleWalletStatus.textContent = `Error: ${error.message || 'Transfer failed'}`;
        } finally {
          transferBtn.classList.remove('loading'); transferBtn.disabled = connectedAddress ? false : true;
        }
      } else {
        transferInput.classList.remove('hidden');
      }
    };
    // Real purchase: approve USDT (if needed) -> buy
    const purchaseTokens = async () => {
      if (!purchaseInput.classList.contains('hidden')) {
        purchaseBtn.classList.add('loading'); purchaseBtn.disabled = true;
        try {
          if (!web3 || !haipContract || !usdtContract || !presaleContract || !connectedAddress) {
            throw new Error('Wallet not connected');
          }
          let usdtAmount = parseFloat(purchaseAmountInput.value);
          if (isNaN(usdtAmount) || usdtAmount <= 0) throw new Error('Please enter a valid positive number');
          const idx = await presaleContract.methods.currentStage().call();
          const maxUser = await presaleContract.methods.maxUsdtUserCanBuy(idx, connectedAddress).call();
          const maxUserFloat = fromUnits(web3, web3.utils.toBN(maxUser), usdtDec);
          if (maxUserFloat <= 0) throw new Error('Your current limit is 0 USDT for this stage.');
          if (usdtAmount > maxUserFloat) {
            usdtAmount = Math.floor(maxUserFloat * 100) / 100;
            purchaseAmountInput.value = usdtAmount.toFixed(2);
            presaleWalletStatus.textContent = `Amount reduced to your current limit: ${usdtAmount.toFixed(2)} USDT.`;
          }
          const usdtUnits = toUnits(web3, usdtAmount, usdtDec);
          const allowance = await usdtContract.methods.allowance(connectedAddress, PRESALE_ADDRESS).call();
          if (web3.utils.toBN(allowance).lt(usdtUnits)) {
            presaleWalletStatus.textContent = 'Approving USDT...';
            await usdtContract.methods.approve(PRESALE_ADDRESS, usdtUnits.toString()).send({ from: connectedAddress });
          }
          let haipAmountStr = '';
          try {
            const tokens = await presaleContract.methods.quoteTokens(idx, usdtUnits.toString()).call();
            const haipFloat = fromUnits(web3, web3.utils.toBN(tokens), haipDec);
            haipAmountStr = ` (~${haipFloat.toFixed(6)} HAIP)`;
          } catch {}
          presaleWalletStatus.textContent = 'Submitting purchase...';
          const tx = await presaleContract.methods.buy(usdtUnits.toString()).send({ from: connectedAddress });
          presaleWalletStatus.innerHTML = `Success${haipAmountStr}! <a target="_blank" href="https://bscscan.com/tx/${tx.transactionHash}">View on BscScan</a>`;
          walletStatus.innerHTML = presaleWalletStatus.innerHTML;
          const balance = await haipContract.methods.balanceOf(connectedAddress).call();
          walletBalance.textContent = `Balance: ${fromUnits(web3, web3.utils.toBN(balance), haipDec).toFixed(6)} HAIP`;
          purchaseInput.classList.add('hidden'); purchaseAmountInput.value = '';
          await refreshPresaleLimits();
          await refreshStageUI();
        } catch (error) {
          walletStatus.textContent = `Error: ${error.message || 'Purchase failed'}`;
          presaleWalletStatus.textContent = `Error: ${error.message || 'Purchase failed'}`;
        } finally {
          purchaseBtn.classList.remove('loading'); purchaseBtn.disabled = connectedAddress ? false : true;
        }
      } else {
        purchaseInput.classList.remove('hidden');
      }
    };
    // Event listeners
    connectWalletBtn.addEventListener('click', connectWallet);
    disconnectWalletBtn.addEventListener('click', disconnectWallet);
    presaleConnectWalletBtn.addEventListener('click', connectWallet);
    presaleDisconnectWalletBtn.addEventListener('click', disconnectWallet);
    transferBtn.addEventListener('click', transferTokens);
    purchaseBtn.addEventListener('click', purchaseTokens);
    // Copy contract address
    function copyContract() {
      const contractAddress = '0x2e5a3548a65e41e119efa48cf67bfdfc361d1a29';
      navigator.clipboard.writeText(contractAddress).then(() => alert('Contract address copied to clipboard!'));
    }
    // Inițializare widget (înainte de conectare)
    (async () => {
      try {
        if (window.ethereum || window.web3) {
          await initWeb3();
          await refreshStageUI();
        }
      } catch {}
    })();
  </script>
</body>
</html>
